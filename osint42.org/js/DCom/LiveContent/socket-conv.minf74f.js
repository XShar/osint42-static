((p,g)=>{XF.Socket=XF.Socket||{};XF.Socket={Server:{},Pusher:{},socketId:"",Channel:"",optServer:"pusher",on:function(a,b){switch(this.optServer){case "pusher":this.Server.bind(a,b);break;case "swoole":this.Server.on(a,b)}},onUser:function(a,b){this.Pusher.user.bind(a,b)},emit:function(a,b){switch(this.optServer){case "pusher":this.Server.trigger("client-"+a,b);break;case "swoole":this.Server.emit(a,b)}},connect:function(a,b,c,d,f,e,k,h,l){let m=null;this.Channel=b;switch(a){case "pusher":if(!k)return;
let n=new Pusher(h,{cluster:l,userAuthentication:{endpoint:XF.canonicalizeUrl("index.php?pusher/user-auth"),headers:{"X-XF-CSRF-Token":XF.config.csrf}},channelAuthorization:{endpoint:XF.canonicalizeUrl("index.php?pusher/auth"),headers:{"X-XF-CSRF-Token":XF.config.csrf}}});n.signin();n.connection.bind("connected",()=>{this.socketId=n.connection.socket_id});this.Pusher=n;a=n.subscribe("private-"+b);a.bind("pusher:subscription_succeeded",()=>{XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/connect"),
{user_id:k,channel:b},()=>{},{global:!1,skipDefault:!0});p.onunload=function(){XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/disconnect"),{user_id:k,channel:b},()=>{},{global:!1,skipDefault:!0})}});m=a;break;case "swoole":switch(c){case "native":m=io((d?d:"https://"+p.location.hostname)+":"+f,{transports:["websocket"]});break;case "proxy":m=io(d?d:"https://"+p.location.hostname,{path:e,transports:["websocket"]})}}return m}};XF.LiveContent=XF.Element.newHandler({options:{domen:null,enableTyping:!1,
convId:null,userId:null,canReply:!0,typingDalay:1500,socketServer:"swoole",connection:"native",path:"/socket.io",port:2020,alertSound:"sound",alertExtra:null,ajaxPagination:!1,replySticky:!1,viewOnline:!1,styleTyping:"editor",pusherKey:null,pusherCluster:null},TYPING_TIMER_LENGTH:1500,typing:!1,lastTypingTime:null,socket:null,dataMessageDetail:null,dataThreadDetail:null,dataWidgetDetail:null,windowChanger:!1,widgets:null,page:null,form:null,init:function(){let a=this.options;XF.Socket.optServer=a.socketServer;
XF.Socket.Server=XF.Socket.connect(a.socketServer,a.convId,a.connection,a.domen,a.port,a.path,a.userId,a.pusherKey,a.pusherCluster);this.socket=XF.Socket;this.TYPING_TIMER_LENGTH=this.options.typingDalay;this.page=g.querySelector(".p-body-pageContent");this.form=XF.findRelativeIf(".p-body-pageContent > form.js-quickReply[action$=add-reply],form.js-quickReply[action$=post]",this.target);if("swoole"===this.options.socketServer)this.socket.on("connect",this.connect.bind(this)),this.socket.on("reconnect",
this.connect.bind(this)),this.socket.on("disconnect",this.disconnectSwoole.bind(this)),this.socket.on("new alert",this.newAlert.bind(this));else{if(!a.userId)return;this.socket.onUser("new alert",this.newAlert.bind(this))}this.options.enableTyping&&(this.socket.on("typing",this.addTyping.bind(this)),this.socket.on("stop typing",this.removeTyping.bind(this)));if(this.options.viewOnline)this.socket.on("updateOnlineBlock",this.loadOnlineBlock.bind(this));this.socket.on("new widget",this.updateWidget.bind(this));
this.socket.on("new message",this.addConvMessage.bind(this));this.socket.on("del message",this.delMessage.bind(this));this.socket.on("restore message",this.restoreMessage.bind(this));this.socket.on("load online",this.loadOnline.bind(this));this.socket.on("load offline",this.loadOffline.bind(this));this.socket.on("change thread",this.changeThread.bind(this));XF.onDelegated(this.page,"mouseover","article.ctaConversationMessageSelf, article.ctaConversationMessageOther",b=>{if(b=b.target.closest("article.ctaConversationMessageSelf, article.ctaConversationMessageOther").querySelector(".message-actionBar"))b.style.visibility=
"visible"});XF.onDelegated(this.page,"mouseout","article.ctaConversationMessageSelf, article.ctaConversationMessageOther",b=>{if(b=b.target.closest("article.ctaConversationMessageSelf, article.ctaConversationMessageOther").querySelector(".message-actionBar"))b.style.visibility="hidden"});if(this.options.ajaxPagination)XF.onDelegated(this.page,"click",".pageNavWrapper a[href]",this.load.bind(this));XF.on(g,"visibilitychange",this.windowChange.bind(this));XF.onDelegated(this.page,"input","form[action$=add-reply]",
this.updateTyping.bind(this));this.initCustomListener.bind(this)},initCustomListener:function(){},loadOnlineBlock:function(a){this.options.viewOnline&&XF.ajax("GET",a.load_url,{},this.renderOnlineBlock.bind(this),{global:!1,skipDefault:!0})},renderOnlineBlock:function(a){if(!a.errors&&!a.exception){var b=g.querySelector(".dcom-lc-online-block");a.html.content&&b?XF.setupHtmlInsert(a.html,function(c,d,f){a.visibleZeroBlock?(b.innerHTML=c.outerHTML,XF.activate(b)):b.children.length&&a.countUsers?(b.innerHTML=
c.outerHTML,XF.activate(b)):!b.children.length&&a.countUsers&&(c.style.display="none",b.innerHTML=c.outerHTML,XF.activate(b),XF.Animate.fadeDown(c,{speed:XF.config.speed.fast}))}):!a.visibleZeroBlock&&b.children.length&&XF.Animate.fadeUp(b,{speed:XF.config.speed.fast,complete(){b.replaceChildren();XF.Animate.fadeDown(b,{speed:XF.config.speed.fast})}})}},updateWidget:function(a){if(a.userId!==this.options.userId){let b=!1;a.widgets.forEach(function(c){g.querySelector("[data-widget-definition="+c+"]")&&
(b=!0)});b&&(this.dataWidgetDetail=a,XF.ajax("post",p.location.href,{},this.loadedWidget.bind(this),{global:!1,skipDefault:!0}))}},loadedWidget:function(a){let b=this;XF.setupHtmlInsert(a.html,function(c,d,f){d.sidebar&&c.append(...function(e){const k=g.implementation.createHTMLDocument("");k.body.innerHTML=e;return k.body.children}(d.sidebar.trim()));c.querySelectorAll("[data-widget-definition]").forEach(function(e,k){b.dataWidgetDetail.widgets.forEach(function(h,l){if(e.getAttribute("data-widget-definition")===
h&&!e.hasAttribute("data-widget-section"))l=g.querySelector('[data-widget-id="'+e.getAttribute("data-widget-id")+'"]'),"new_posts"!==h&&"new_threads"!==h||!l.closest(".p-body-content")?(g.querySelector('[data-widget-id="'+e.getAttribute("data-widget-id")+'"]').replaceWith(e),XF.activate(e)):(h=l.querySelector(".js-threadListItem-"+b.dataWidgetDetail.content_id))?"del"===b.dataWidgetDetail.event?b.globalDelThread(e,h):b.globalEditRestoreThread(e,h):(h=e.querySelector(".js-threadListItem-"+b.dataWidgetDetail.content_id))&&
b.globalNewRestoreThread(h,l);else if(e.getAttribute("data-widget-definition")===h&&e.hasAttribute("data-widget-section")){l='[data-widget-id="'+e.getAttribute("data-widget-id")+'"][data-widget-section="'+e.getAttribute("data-widget-section")+'"]';h='[data-widget-id="'+e.nextElementSibling.getAttribute("data-widget-id")+'"][data-widget-section="'+e.nextElementSibling.getAttribute("data-widget-section")+'"]';let m=g.querySelector(l);l=g.querySelector(h);m?(!l&&!c.querySelectorAll("[data-widget-definition]")[k-
1].hasAttribute("data-widget-section")&&m.prev().length&&m.prev()[0].hasAttribute("data-widget-section")&&XF.Animate.fadeUp(m.previousElementSibling,{complete:()=>m.previousElementSibling.remove()}),m.replaceWith(e),XF.activate(e)):l&&(XF.display(e,"none"),l.before(e),XF.activate(e),XF.Animate.fadeDown(e))}})})})},newAlert:function(a){-1!==a.users.indexOf(this.options.userId)&&XF.ajax("post",XF.config.url.basePath,{},()=>{},{global:!1,skipDefault:!0})},windowChange:function(){let a={},b=this.options.convId.match(/[\w|\w-\w]+[^-\d+]/i);
a.userId=this.options.userId;a.convId=this.options.convId;a.contentId=this.options.convId.match(/\d+/i)?this.options.convId.match(/\d+/i)[0]:this.options.convId.match(/\d+/i);a.contentType=b[0];g.hidden?("swoole"===this.options.socketServer&&this.socket.emit("window close",a),XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/disconnect"),{user_id:this.options.userId,channel:this.options.convId},this.loadOffline.bind(this),{global:!1,skipDefault:!0})):("swoole"===this.options.socketServer&&
this.socket.emit("window open",a),XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/connect"),{user_id:this.options.userId,channel:this.options.convId},this.loadOnline.bind(this),{global:!1,skipDefault:!0}),XF.ajax("post",XF.config.url.basePath,{},()=>{},{global:!1,skipDefault:!0}))},loadOffline:function(a){if("board"!==this.options.convId&&this.options.userId!=a.userId){let b=g.querySelectorAll(".p-body-sidebar, .block--messages");for(let c=0;c<b.length;c++)b[c].querySelectorAll("a.avatar").length&&
b[c].querySelectorAll("a.avatar").forEach(function(d,f){d.getAttribute("data-user-id")==a.userId&&(d.classList.remove("dcom-lc-avaOnline"),d.classList.add("dcom-lc-avaOffline"))})}},loadOnline:function(a){if("board"!==this.options.convId&&this.options.userId!=a.userId){let b=g.querySelectorAll(".p-body-sidebar, .block--messages");for(let c=0;c<b.length;c++)b[c].querySelectorAll("a.avatar").length&&b[c].querySelectorAll("a.avatar").forEach(function(d,f){d.getAttribute("data-user-id")==a.userId&&(d.classList.remove("dcom-lc-avaOffline"),
d.classList.add("dcom-lc-avaOnline"))})}},load:function(a){a.preventDefault();let b=this,c=a.target.href.substring(0,a.target.href.indexOf("#"));XF.ajax("GET",c?c:a.target.href,{},this.loaded.bind(this),{global:!0,skipDefault:!0}).finally(()=>{b.loading=!1;history.pushState(null,null,a.target.href)})},loaded:function(a){let b=g.querySelector('.menu--pageJump[data-menu][aria-hidden="false"]'),c=this;b&&XF.trigger(b,"menu:close");XF.setupHtmlInsert(a.html,function(d,f,e){XF.off(g,"click.inlineDComLive");
c.page.replaceChildren(d);d=XF.dimensions(d);e=g.documentElement;f=e.scrollTop;e=f+e.clientHeight;(d.top<f+50||d.top>e)&&XF.smoothScroll(Math.max(0,d.top-110),!1,200)},!0);this.options.replySticky&&this.form&&(this.form.querySelector(".editorPlaceholder-editor").classList.add("is-hidden"),this.form.querySelector(".editorPlaceholder-placeholder").classList.remove("is-hidden"))},getMessagesContainer:function(){let a="",b=this.form;switch(this.dataMessageDetail.content){case "thread":a="div[data-type='post'] .js-replyNewMessageContainer";
break;case "profile_post":a="< .js-replyNewMessageContainer";break;case "profile_post_comment":a="< .js-messageResponses | .js-replyNewMessageContainer",b=g.querySelector("form.comment[action$='/"+this.dataMessageDetail.parent_id+"/add-comment']")}return a?XF.findRelativeIf(a,b):g.querySelector(".js-replyNewMessageContainer")},connect:function(){let a={},b=this.options.convId.match(/[\w|\w-\w]+[^-\d+]/i);a.userId=this.options.userId;a.convId=this.options.convId;a.contentId=this.options.convId.match(/\d+/i)?
this.options.convId.match(/\d+/i)[0]:this.options.convId.match(/\d+/i);a.contentType=b[0];a.event="connect";this.socket.emit("add user",a);XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/connect"),{user_id:this.options.userId,channel:this.options.convId},()=>{},{global:!1,skipDefault:!0})},disconnectSwoole:function(){XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/disconnect"),{user_id:this.options.userId,channel:this.options.convId},()=>{},{global:!1,skipDefault:!0})},alertSound:function(){if("true"!==
XF.Cookie.get("dcom_lc_disable_sound"))switch(this.options.alertSound){case "sound":this.audio=new Audio(XF.canonicalizeUrl(this.options.alertExtra));var a=this.audio.play();void 0!==a&&a.then(b=>{}).catch(b=>{});break;case "voice":speechSynthesis.speak(new SpeechSynthesisUtterance(this.options.alertExtra));break;case "custom_sound":this.audio=new Audio(XF.canonicalizeUrl(this.options.alertExtra)),a=this.audio.play(),void 0!==a&&a.then(b=>{}).catch(b=>{})}},highlightBackgroundElement(a,b){XF.Transition.addClassTransitioned(a,
"is-mod-selected",()=>{setTimeout(()=>{XF.Transition.removeClassTransitioned(a,"is-mod-selected")},b)})},changeThread:function(a){if(a.user_id!=this.options.userId){this.dataThreadDetail=a;var b="whats_new_posts"!==this.options.convId||this.redirect?a.redirect??p.location.href:p.location.href.match(/(.*?whats-new\/posts\/)(\d+\/)/i)?.[1]||p.location.href;XF.ajax("post",b,{},this.loadChangeThread.bind(this),{global:!1,skipDefault:!0}).finally(()=>{this.redirect&&(this.redirect=!1);history.pushState(null,
null,b)})}},globalDelThread(a,b){const c=a.querySelector("."+b.className.match(/js-threadListItem-(\d+)/i)?.[0]||null);if(c)XF.Animate.fadeUp(b,{complete:()=>{XF.display(c,"none");b.replaceWith(c);XF.activate(c);XF.Animate.fadeDown(c)}});else{const d=b.parentNode,f=this.options.convId.match(/forum-(\d+)/i)?".js-threadList":".structItemContainer",e=a.querySelector(f).lastElementChild;this.highlightBackgroundElement(b,500);XF.Animate.fadeUp(b,{complete:()=>{b.remove();XF.display(e,"none");d.append(e);
XF.Animate.fadeDown(e)}})}},globalNewRestoreThread(a,b){XF.hideTooltips();XF.display(a,"none");var c=a.previousElementSibling,d=a.nextElementSibling,f=this.options.convId.match(/forum-(\d+)/i)?".js-threadList":".structItemContainer";f=b.querySelector(f);if(!c&&d)f.prepend(a),f.lastElementChild.remove();else if(c&&!d)f.lastElementChild.remove(),f.append(a);else if(c||d)if(c=c.className.match(/js-threadListItem-(\d+)/i)?.[1]||null){if(b=b.querySelector(".js-threadListItem-"+c))f.lastElementChild.remove(),
b.after(a)}else{if(d=d.className.match(/js-threadListItem-(\d+)/i)?.[1]||null)if(b=b.querySelector(".js-threadListItem-"+d))f.lastElementChild.remove(),b.before(a)}else f.prepend(a);XF.Animate.fadeDown(a,{display:"table",complete:()=>{this.highlightBackgroundElement(a,500)}})},globalEditRestoreThread(a,b){a=a.querySelector("."+b.className.match(/js-threadListItem-(\d+)/i)?.[0]||null);var c=[...b.parentNode.children].indexOf(b);const d=[...a.parentNode.children].indexOf(a);a&&c===d?(b.replaceWith(a),
XF.activate(a),this.highlightBackgroundElement(a,500)):a&&c!==d&&(c=b.parentNode,b.replaceWith(a),0===d?c.insertBefore(a,c.children[d]):c.insertBefore(a,c.children[d].nextSibling),XF.activate(a),this.highlightBackgroundElement(a,500))},loadChangeThread(a){if(!a.errors&&!a.exception)if(a.redirect)this.redirect=!0,this.dataThreadDetail.redirect=a.redirect,this.changeThread(this.dataThreadDetail);else{var b=this,c=g.querySelector(".js-threadListItem-"+b.dataThreadDetail.thread_id);c?XF.setupHtmlInsert(a.html,
function(d,f,e){"del"===b.dataThreadDetail.event?b.globalDelThread(d,c):b.globalEditRestoreThread(d,c)}):XF.setupHtmlInsert(a.html,(d,f,e)=>{if(d=d.querySelector(".js-threadListItem-"+b.dataThreadDetail.thread_id))this.globalNewRestoreThread(d,b.page),e()})}},delMessage:function(a){this.dataMessageDetail=a;a.load_url?XF.ajax("post",a.load_url,{},this.loadDelMessage.bind(this),{global:!1,skipDefault:!0}):this.loadDelMessage(a)},restoreMessage:function(a){this.dataMessageDetail=a;a.load_url&&XF.ajax("post",
a.load_url,{last_date:a.lastDate},this.loadRestoreMessage.bind(this),{global:!1,skipDefault:!0})},loadDelMessage:function(a){const b='[data-content="profile-post-comment-'+this.dataMessageDetail.message_id+'"]',c='[data-content="post-'+this.dataMessageDetail.message_id+'"]',d='[data-content="profile-post-'+this.dataMessageDetail.message_id+'"]',f="profile_post_comment"===this.dataMessageDetail.content?g.querySelector(b)?.parentNode:g.querySelector(c+","+d);a.delMessageId?XF.Animate.fadeUp(f,{complete:()=>
f.remove()}):XF.setupHtmlInsert(a.html,function(e,k,h){XF.Animate.fadeUp(f,{complete:()=>{XF.display(e,"none");f.replaceWith(e);XF.activate(e);XF.Animate.fadeDown(e)}})})},loadRestoreMessage:function(a){if(!a.errors&&!a.exception){var b=this,c="profile_post_comment"===this.dataMessageDetail.content,d='[data-content="profile-post-comment-'+b.dataMessageDetail.message_id+'"]',f='[data-content="post-'+b.dataMessageDetail.message_id+'"]',e='[data-content="profile-post-'+b.dataMessageDetail.message_id+
'"]',k=c?g.querySelector(d)?.parentNode:g.querySelector(f+","+e);if(k)XF.setupHtmlInsert(a.html,function(h,l,m){XF.Animate.fadeUp(k,{complete:()=>{let n;n="thread"===b.dataMessageDetail.content?h.querySelector("article[data-content$=post-"+b.dataMessageDetail.message_id+"]"):h;XF.display(n,"none");k.replaceWith(n);XF.activate(n);XF.Animate.fadeDown(n)}})});else{d='[data-content="profile-post-comment-'+a.next_content_id+'"]';f='[data-content="post-'+a.next_content_id+'"]';e='[data-content="profile-post-'+
a.next_content_id+'"]';const h=c?g.querySelector(d)?.parentNode:g.querySelector(f+","+e);h?XF.setupHtmlInsert(a.html,function(l,m,n){let q;q="thread"===b.dataMessageDetail.content?l.querySelector("article[data-content$=post-"+b.dataMessageDetail.message_id+"]"):l;XF.Animate.fadeUp(q,{complete:()=>{XF.display(q,"none");"profile_post"===b.dataMessageDetail.content?h.after(q):h.before(q);XF.activate(q);XF.Animate.fadeDown(q)}})}):!a.next_content_id&&(this.insertMessages(a.html),c=this.form.querySelector('input[name="last_date"]'))&&
(c.value=a.lastDate)}}},addConvMessage:function(a){this.dataMessageDetail=a;if(a.user_id!=this.options.userId)switch(a.event){case "new":XF.ajax("post",a.load_url,{},this.loadNewMessage.bind(this),{global:!1,skipDefault:!0});this.alertSound();break;case "profile":XF.ajax("post",a.load_url,{},this.loadProfileMessage.bind(this),{global:!1,skipDefault:!0});this.alertSound();break;case "profile_edit":XF.ajax("post",a.load_url,{},this.loadProfileMessageEdit.bind(this),{global:!1,skipDefault:!0});this.alertSound();
break;case "edit":XF.ajax("post",a.load_url,{},this.loadEditMessage.bind(this),{global:!1,skipDefault:!0});break;case "reaction":XF.ajax("post",a.load_url,{},this.loadReactionMessage.bind(this),{global:!1,skipDefault:!0})}},loadProfileMessage:function(a){if(!a.errors&&!a.exception){var b=location.href.match(/(page-)(\d+)/i),c=g.querySelector(".pageNav-page");if(c){if(c=c.querySelector("a").text,!b&&"1"===c&&(this.insertMessages(a.html),b=this.form.querySelector('input[name="last_date"]')))b.value=
a.lastDate}else if(this.insertMessages(a.html),b=this.form.querySelector('input[name="last_date"]'))b.value=a.lastDate}},loadProfileMessageEdit:function(a){if(!a.errors&&!a.exception){var b=this,c="",d;XF.setupHtmlInsert(a.html,function(f,e,k){"profile_post_comment"===b.dataMessageDetail.content?(c=".comment[data-content$=profile-post-comment-"+b.dataMessageDetail.message_id+"]",d=b.page.querySelector(c).parentNode):"profile_post"===b.dataMessageDetail.content&&(c="article[data-content$=profile-post-"+
b.dataMessageDetail.message_id+"]",d=b.page.querySelector(c));d&&c&&XF.Animate.fadeUp(d,{complete:()=>{XF.display(f,"none");d.replaceWith(f);XF.activate(f);XF.Animate.fadeDown(f)}})})}},loadReactionMessage:function(a){if(!a.errors&&!a.exception){var b=this;XF.setupHtmlInsert(a.html,function(c,d,f){const e="profile_post_comment"===b.dataMessageDetail.content?".js-commentReactionsList":".js-reactionsList",k=b.page.querySelector('span[id$="'+b.dataMessageDetail.message_id+'"]').parentElement.querySelector("footer").querySelector(e);
k&&XF.Animate.fadeUp(k,{complete:()=>{const h=c.querySelector("footer").querySelector(e);XF.display(h,"none");k.replaceWith(h);XF.activate(h);h.children.length&&XF.Animate.fadeDown(h)}})})}},loadEditMessage:function(a){if(!a.errors&&!a.exception){var b=this;XF.setupHtmlInsert(a.html,function(c,d,f){const e="article[data-content$=post-"+b.dataMessageDetail.message_id+"]",k=b.page.querySelector(e);if(k)if(XF.Animate.fadeUp(k,{complete:()=>{let h=c.querySelector(e);XF.display(h,"none");k.replaceWith(h);
XF.activate(h);XF.Animate.fadeDown(h)}}),f=a.threadChanges||{},f.title&&(g.querySelector("h1.p-title-value").innerHTML=d.h1,g.querySelector("title").innerHTML=d.title,XF.config.visitorCounts.title_count&&a.visitor&&(XF.pageTitleCache=d.title,XF.pageTitleCounterUpdate(a.visitor.total_unread))),f.customFields){const h=c.closest(".js-threadStatusField"),l=XF.findRelativeIf("< .block--messages | .js-threadStatusField",this.target);h&&l&&XF.Animate.fadeUp(l,{speed:XF.config.speed.fast,complete(){l.parentNode.replaceChild(h,
l);XF.Animate.fadeDown(l,{speed:XF.config.speed.fast})}})}else c.querySelector(".js-threadStatusField").remove()})}},loadNewMessage:function(a){var b=location.href.match(/(page-)(\d+)/i),c=g.querySelector(".pageNav-page:last-of-type");if(c){if(c=c.querySelector("a").text,b&&b[2]==c&&!a.errors&&!a.exception&&(this.insertMessages(a.html),b=this.form.querySelector('input[name="last_date"]')))b.value=a.lastDate}else!a.errors&&!a.exception&&(this.insertMessages(a.html),b=this.form.querySelector('input[name="last_date"]'))&&
(b.value=a.lastDate)},insertMessages:function(a){XF.Message.insertMessages(a,this.getMessagesContainer(),"profile_post"!==this.dataMessageDetail.content)},updateTyping:function(){this.typing||(this.typing=!0,XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/typing"),{user_id:this.options.userId,channel:this.options.convId,socket_id:this.socket.socketId},this.emitTyping.bind(this),{global:!1,skipDefault:!0}));this.lastTypingTime=(new Date).getTime();setTimeout(()=>{(new Date).getTime()-this.lastTypingTime>=
this.TYPING_TIMER_LENGTH&&this.typing&&(XF.ajax("post",XF.canonicalizeUrl("index.php?socket-request/stop-typing"),{user_id:this.options.userId,channel:this.options.convId,socket_id:this.socket.socketId},this.emitStopTyping.bind(this),{global:!1,skipDefault:!0}),this.typing=!1)},this.TYPING_TIMER_LENGTH)},emitTyping:function(a){if("swoole"===this.options.socketServer){let b={};b.userId=this.options.userId;b.convId=this.options.convId;b.load_url=a.load_url;this.socket.emit("typing",b)}},emitStopTyping:function(a){"swoole"===
this.options.socketServer&&(a={},a.userId=this.options.userId,a.convId=this.options.convId,this.socket.emit("stop typing",a))},addTyping:function(a){XF.ajax("GET",a.load_url,{},this.renderTyping.bind(this),{global:!1,skipDefault:!0})},renderTyping:function(a){if(!a.errors&&!a.exception&&this.options.enableTyping){var b=g.querySelector(".message--typing"),c=XF.createElementFromString(a.html.content);this.options.replySticky&&this.form&&(c.style.bottom=this.form.clientHeight);if(b){var d=b.querySelectorAll(".message-avatar-wrapper");
let f=b.querySelector(".message-avatar-wrapper:last-of-type"),e=Array.from(d);XF.Animate.fadeDown(b,{speed:XF.config.speed.fast});b=b.querySelector(".message-avatar");c=c.querySelector(".message-avatar-wrapper");e.some(function(k,h){return k.getAttribute("data-avaid")==a.userId})||(6>d.length?f.style.marginRight="-15px":d[0].remove(),b.append(c))}else switch(this.options.styleTyping){case "editor":XF.Message.insertMessages(a.html,g.querySelector(".block-container.lbContainer"),!0);break;case "modal":d=
XF.createElementFromString('<div class="dcom-lc-typing notices notices--floating"></div>'),d.append(c),c.style.display="none",g.querySelector(".js-bottomFixTarget").prepend(d),XF.Animate.fadeDown(c,{speed:XF.config.speed.fast})}}},removeTyping:function(a){if(this.options.enableTyping){let b;switch(this.options.styleTyping){case "editor":b=g.querySelector(".message--typing");break;case "modal":b=g.querySelector(".dcom-lc-typing")}if(b){let c=b.querySelectorAll(".message-avatar-wrapper"),d=b.querySelector(".message-avatar-wrapper:last-of-type");
if(1<c.length)c.forEach(function(f){f.getAttribute("data-avaid")==a&&f.remove()}),d.style.marginRight="0px";else switch(this.options.styleTyping){case "editor":XF.Animate.fadeUp(b,{speed:XF.config.speed.fast,complete(){b.remove()}});break;case "modal":XF.Animate.fadeUp(b.querySelector(".message--typing"),{speed:XF.config.speed.fast,complete(){b.remove()}})}}}}});XF.LiveContentTooltip=XF.Element.newHandler({options:{delay:200,usersList:null},tooltipHtml:null,trigger:null,tooltip:null,loading:!1,init:function(){const a=
this.target;let b=this.options.usersList?XF.findRelativeIf(this.options.usersList,a):[];b&&(this.tooltipHtml=b,this.tooltip=new XF.TooltipElement(this.getContent.bind(this),{extraClass:"tooltip--basic",placement:"bottom",html:!0}),this.trigger=new XF.TooltipTrigger(a,this.tooltip,{maintain:!0,delayIn:this.options.delay,trigger:"hover focus touchhold"}),this.trigger.init())},getContent:function(){return this.tooltipHtml}});XF.Element.extend("editor-placeholder",{__backup:{click:"_clickDComLiveEd"},
click:function(a){this._clickDComLiveEd(a);setTimeout(this.resize,0)},resize:function(){let a=g.querySelector(".message--typing");var b=g.querySelector(".live-content");b=XF.Element.getHandler(b,"live-content");b.options.replySticky&&a&&(a.style.bottom=b.form.clientHeight)}});XF.Element.extend("quote",{__backup:{click:"_clickDComLive"},click:function(a){this._clickDComLive(a);a=g.querySelector(".live-content");let b=g.querySelector(".editorPlaceholder");XF.Element.getHandler(a,"live-content").options.replySticky&&
XF.trigger(b,"click")}});XF.Element.extend("inline-mod",{__backup:{init:"_initDComLive"},bar:null,init:function(){if(this.options.type){this.options.href||console.error("No inline mod href specified");var a=this.options.searchTarget;if("*"===a)var b=g;else a&&a.length?(b=XF.findRelativeIf(a,this.target),b||(console.error("Search target %s not found, falling back to children",a),b=this.target)):b=this.target;this.searchTarget=b;this.cookie=this.options.cookieBase+"_"+this.options.type;XF.onDelegated(b,
"click.inlineDComLive",this.options.toggle,this.onToggle.bind(this));XF.onDelegated(b,"click.inlineDComLive",this.options.actionTrigger,this.onActionTrigger.bind(this));a=this.getCookieValue();this._initialLoad(a);this._updateCounter(a.length);setTimeout(()=>{XF.on(g,"xf:reinit",c=>{({element:c}=c);this.searchTarget.contains(c)&&c.querySelector(this.options.toggle)&&this.recalculateFromCookie()})},0);if(a=g.querySelector(".inlineModBar"))this.bar=a}else console.error("No inline mod type specified")}});
XF.Element.extend("page-jump",{__backup:{go:"_goDComLive"},go:function(){var a=g.querySelector(".live-content");if((a=XF.Element.getHandler(a,"live-content"))&&a.options.ajaxPagination){a=parseInt(this.input.value,10);if(isNaN(a)||1>a)a=1;let b=this.options.pageUrl,c=this.options.sentinel,d=b.replace(c,a);d===b&&(d=b.replace(encodeURIComponent(c),a));d=XF.canonicalizeUrl(d);XF.ajax("GET",d,{},this.loaded.bind(this),{global:!0,skipDefault:!0}).finally(()=>{self.loading=!1;history.pushState(null,null,
d)})}else this._goDComLive()},loaded:function(a){var b=g.querySelector(".live-content");let c=XF.Element.getHandler(b,"live-content");(b=g.querySelector('.menu--pageJump[data-menu][aria-hidden="false"]'))&&XF.trigger(b,"menu:close");XF.setupHtmlInsert(a.html,function(d,f,e){XF.off(g,"click.inlineDComLive");c.page.replaceChildren(d);d=XF.dimensions(d);e=g.documentElement;f=e.scrollTop;e=f+e.clientHeight;(d.top<f+50||d.top>e)&&XF.smoothScroll(Math.max(0,d.top-110),!1,200)},!0);this.options.replySticky&&
(c.form.querySelector(".editorPlaceholder-editor").classList.add("is-hidden"),c.form.querySelector(".editorPlaceholder-placeholder").classList.remove("is-hidden"))}});XF.Element.register("live-content","XF.LiveContent");XF.Element.register("live-content-tooltip","XF.LiveContentTooltip")})(window,document);